# Current issue
- 如何评估交易策略整体是否有效
    - 影响因素两方面：
        - 交易模式
            加减仓策略（超参数、顺序变化细节极多）
            反应时间（T+1、收盘、实时）
        - 模型
            大：模型数量、各自预测目标、训练时间、简单组合
            小：上述细节确定后的单个模型调优，具体模型类型(lgbm,xgb)、调参、ensemble
    - 评估方法：
        - 随机选股、或者选历史重仓个股，观察择时能力与回撤控制。关键是股票群不能表现太好。
        
- 模型验证评估方法
	回测：耗时但最准
	模型跑批比较：耗时少但评估方法需要重新设计，准确度低。
	

- 交易模式超参数确定
	预测信号与仓位关系
	止损与加仓线 与历史波动的关系
	是否需要放大缩小止损加仓线幅度、加仓次数


- 加入更多变量 最近波动率 历史波动率 历史分位数
	历史需要全量，这是个坑，改为5年？





# Ideas
- 训练用全量数据，人为选股，实际运行时只跑人为选定的股票池。

# Finished list
- trading plan部分测试
- ml_model部分测试
- 推进式模型


# To do list(codes):
- 数据补全
- 确定模型的评价标准
    模型如何评价movement前短期不同时点预测成功率、准确率的差异
        即同样一段波动3天前可能无法进行预测，但到一天前可预测，实践中应以最新的预测为准，只要该最新预测命中即可，过去预测无所谓。
        但对于模型来说，只要拥有同样的y值，最新预测之前的几个预测可能同样重要。
        问题归结为y变量设置，当前想法时，先确定行情波段，每个行情波动进行一次预测即可。
        同时需注意，预测结果大部分时间应有一定的连续性。
    回归模型如何评价
        预测少了与预测多了，重要性不同，R方显然不合适。
- 调整模型y值，幅度是否应该根据行情来定，而非指定时间段（一个月、一周等）。当然预测整个行情最终幅度难度极大，预测该行情在最近一段时间（周、月）的表现同样有合理性。
- 增加衍生变量，包括上下影线、柱体相对长度，短期波动率等，同时考虑对重要性高的特征进行衍生组合。
- 调整模型，类型（分类vs回归）、参数（过拟合、欠拟合、树深度）、叠加逻辑回归与Lar回归等。
- 调整交易策略与参数，止损加仓线根据近期波动率调整
- 增加股票基本分类数据：板块、概念等标签，考虑增加市盈率、市净率等




# To do list(Not codes):
1. 模拟盘测试操作，验证可操作性与收益
2. 实盘操作，验证可操作性与收益



Considerations：
1. 反应时间越快越好：止损加仓止盈
    隔日开盘：
        反应太慢，隔日损失惨重
    当日尾盘：
        尾盘最高且触及加仓线，或尾盘最低且触及平仓线，怎么办？
        尾盘涨跌停，默认交易失败，隔日开盘交易吗？
    实时交易：
        是否能及时买入：急速拉升或跳水怎么办？比如盘中急拉涨停，来不及加仓。
        触发式下单也有缺陷，买入埋单会锁定资金吗？如果一天同时触发加仓与止损线如何处理
        大幅波动如何回测：日内同时触及平仓线与加仓线，需区分先后，麻烦
        实盘如何交易的问题：智能交易（设置触发条件），加仓是否会锁定资金，导致资金不足无法覆盖全部情况。

2. 模型 看权重大的变量进行衍生组合
	模型自己能衍生什么样的变量 难度如何
	时间序列型数据如何与传统机器学习结合
		传统为独立单点数据 没有

3. 机器学习数据类型迁移
	传统：独立点
	其他：时序 网络（点间包含属性有向边）

4. 需要类似于pooling的模块，抽取高维度特征

5. 数据宽度（股票数）与数据深度（时间长度）

6. 对根据截止到现在的数据筛选出的股票进行历史回测时，股票池范围的选择本身就间接引入未来信息。因为只会选择至今表现好的股票纳入股票池，而至今表现是否良好在过去是未知的。相当于预先排雷。

7. precision vs recall，在有止损的情况下（但要小心触雷导致一字跌停无法止损），可尝试召回率优先：
10次交易，9次止损，每次损失1.1%，总损失约为10%，一次翻倍，赚0.6*1/1=60%，则合计回报率50%。

8. 
实际交易价格总是保留两位小数，回测时用前复权是否需要四舍五入（或向下舍入）？也许不需要，因为原始价格为四舍五入后的实际交易价格，前复权后不四舍五入反而准确。

9. 尽量用模型数据确定交易策略的参数，减少人为指定（缺乏合理性，且实验调参会存在过拟合问题）

9. 
超参数与模型确定超参数都会导致过拟合，只是程度有差别。唯一能一定程度上检验（而非解决）的办法是使用独立的测试集。调参时的折中办法是选择验证集与测试集都最优的参数或模型（如果有的话）。

10. 当前可能问题：1. 交易次数太少 2. 训练数据时间不够（跨牛熊，最好多次）

11. 模型的方向应该是控制回撤，涨得比疯牛时慢(60 70%)，但大跌时能逃过60-70%。

