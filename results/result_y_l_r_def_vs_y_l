A strange phenomenom occurs that few number of nan in y will greatly affect the performance of model.


C:\ProgramData\Anaconda3\python.exe C:/Users/Administrator/Documents/Projects/Quant/DM/ml_model.py
2017-01-01 2018-12-31
Time slice keys in hdf5: 2017/0101-0101,2018/0101-0101

Current key: 2017/0101-0101
Current slice size(length): 333371
Current subsample size(length): 3333

Current key: 2018/0101-0101
Current slice size(length): 347712
Current subsample size(length): 3477

Total concatenating size: 6810
Result dataset size: 6810
<class 'pandas.core.frame.DataFrame'>
Int64Index: 6810 entries, 20171116 to 20181130
Columns: 2037 entries, (10MA/20MA-1) to vol0
dtypes: float16(1987), float64(44), int64(1), uint8(5)
memory usage: 28.2 MB
None
===== (6810,) (6810,)
          y_l_rise  y_l_decline  y_l_avg  y_s_rise  y_s_decline  y_s_avg  y_l  \
date
20170522       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170703       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171123       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171106       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170915       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20181120       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20181213       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20180404       0.0          0.0      NaN       0.0          0.0      NaN  0.0

          y_l_r
date
20170522    0.0
20170703    0.0
20171123    0.0
20171106    0.0
20170915    0.0
20181120    0.0
20181213    0.0
20180404    0.0
(4731, 2036) (1483, 2036)
          y_l_rise  y_l_decline   y_l_avg  y_s_rise  y_s_decline   y_s_avg  \
date
20180702  0.047312    -0.163978 -0.068203  0.047312    -0.075806 -0.015995
20180702  0.165563    -0.033113  0.049453  0.039735    -0.033113 -0.000888
20180702  0.008969    -0.266816 -0.147618  0.008969    -0.118834 -0.045511
20180702  0.152809    -0.056180  0.055038  0.044944    -0.056180  0.004933
20180702  0.035185    -0.148148 -0.037396  0.016667    -0.148148 -0.061408
20180702  0.108163    -0.106122 -0.006134  0.028571    -0.093878 -0.016856
20180702  0.086592    -0.143855  0.004350  0.025140    -0.053073 -0.005898
20180702  0.106218    -0.077720  0.022556  0.039896    -0.077720 -0.016733
20180702  0.070423    -0.070423 -0.001644  0.009577    -0.070423 -0.022191
20180702  0.218097    -0.073086  0.043194  0.017401    -0.071926 -0.020303
20180702  0.058115    -0.055160  0.001152  0.005051    -0.050505 -0.015889
20180702  0.159667    -0.061807  0.052275  0.043978    -0.061807 -0.006260
20180702  0.140932    -0.052753  0.037754  0.062380    -0.038891  0.012364
20180702  0.065038    -0.120611 -0.018995  0.000000    -0.120611 -0.065893
20180702  0.012158    -0.144883 -0.067281  0.012158    -0.144883 -0.077498
20180702  0.184739    -0.013047  0.087529  0.080583    -0.013047  0.048225
20180702  0.116920    -0.068441  0.021932  0.024715    -0.068441  0.000435
20180702  0.087709    -0.161370 -0.013477  0.062248    -0.075680  0.004469
20180703  0.013294    -0.090039 -0.038908  0.013294    -0.088626 -0.040594
20180703  0.109716    -0.030568  0.048833  0.079148    -0.030568  0.026238

               y_l     y_l_r
date
20180702 -0.163978 -0.122984
20180702  0.165563  0.124172
20180702 -0.266816 -0.200112
20180702  0.152809  0.114607
20180702 -0.148148 -0.111111
20180702  0.108163 -0.079592
20180702 -0.143855  0.064944
20180702  0.106218  0.079663
20180702 -0.070423 -0.052817
20180702  0.218097  0.163573
20180702  0.058115  0.043586
20180702  0.159667  0.119750
20180702  0.140932  0.105699
20180702 -0.120611 -0.090458
20180702 -0.144883 -0.108663
20180702  0.184739  0.138554
20180702  0.116920  0.087690
20180702 -0.161370 -0.121027
20180703 -0.090039 -0.067529
20180703  0.109716  0.082287

--------------------Train network--------------------

 (4731, 2036) (4731,) {'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}, 'train_indexes': (0, None)}

----------Train layer 0----------
slice(0, None, None)

Train l2_y_l
C:\ProgramData\Anaconda3\lib\site-packages\lightgbm\basic.py:1042: UserWarning: categorical_feature in Dataset is overridden. New categorical_feature is ['area', 'exchange', 'is_hs', 'market']
  warnings.warn('categorical_feature in Dataset is overridden. New categorical_feature is {}'.format(sorted(list(categorical_feature))))
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 19.04s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.1, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=50,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                  feature  importance_raw  importance_percent
1865                             sz50_vol              51                3.40
936      p100mv_(20k_low/p20mv_20k_low-1)              49                3.27
466                  (high/p20min_high-1)              48                3.20
1099      p20mv_(10k_avg/p10mv_10k_avg-1)              48                3.20
202        (250k_open/p750mv_250k_open-1)              47                3.13
1517      p80mv_(20k_avg/p20mv_20k_avg-1)              47                3.13
207          (250k_vol/p750mv_250k_vol-1)              47                3.13
1473   p60mv_(60k_high-60k_close)/60k_avg              47                3.13
946      p10mv_(10k_high-10k_low)/10k_avg              47                3.13
1472  p60mv_(60k_close/p60mv_60k_close-1)              47                3.13
1460   p60mv_(20k_high-20k_close)/20k_avg              43                2.87
1074          p180mv_lower_shadow/60k_avg              42                2.80
955          p10mv_(5k_avg/p5mv_5k_avg-1)              42                2.80
521                 (open/p20mean_open-1)              42                2.80
337        (60k_close/p180mv_60k_close-1)              41                2.73
1303             p3mv_lower_shadow/3k_avg              41                2.73
1373                p4mv_upper_shadow/avg              41                2.73
1312     p40mv_(10k_high-10k_low)/10k_avg              41                2.73
1527    p80mv_(20k_open/p20mv_20k_open-1)              40                2.67
1128      p20mv_(5k_high-5k_close)/5k_avg              40                2.67
Among 2036 features, 1825 features are not used in the model

--------------------Predict--------------------

----------Layer 0 predicts----------

y_l_r
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]      4     -0.081       -0.101     0.088     0.042    -0.165
(-0.05,0.00]     469     -0.031       -0.057     0.108     0.305    -0.348
(0.00,0.05]      999      0.003        0.000     0.126     0.623    -0.323
(0.05,0.10]       11      0.034       -0.049     0.165     0.398    -0.153
(0.10,0.15]        0        NaN          NaN       NaN       NaN       NaN
(0.15,0.20]        0        NaN          NaN       NaN       NaN       NaN
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]      4     -0.139       -0.134     0.063    -0.067    -0.220
(-0.05,0.00]     469     -0.044       -0.079     0.144     0.407    -0.463
(0.00,0.05]      999     -0.002       -0.058     0.169     0.830    -0.430
(0.05,0.10]       11      0.046       -0.065     0.220     0.530    -0.204
(0.10,0.15]        0        NaN          NaN       NaN       NaN       NaN
(0.15,0.20]        0        NaN          NaN       NaN       NaN       NaN
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_avg
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]      4     -0.052       -0.065     0.050     0.016    -0.095
(-0.05,0.00]     469     -0.017       -0.014     0.066     0.213    -0.331
(0.00,0.05]      999      0.004        0.000     0.077     0.556    -0.347
(0.05,0.10]       11      0.037       -0.018     0.104     0.309    -0.036
(0.10,0.15]        0        NaN          NaN       NaN       NaN       NaN
(0.15,0.20]        0        NaN          NaN       NaN       NaN       NaN
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN


























C:\ProgramData\Anaconda3\python.exe C:/Users/Administrator/Documents/Projects/Quant/DM/ml_model.py
2017-01-01 2018-12-31
Time slice keys in hdf5: 2017/0101-0101,2018/0101-0101

Current key: 2017/0101-0101
Current slice size(length): 333371
Current subsample size(length): 3333

Current key: 2018/0101-0101
Current slice size(length): 347712
Current subsample size(length): 3477

Total concatenating size: 6810
Result dataset size: 6810
<class 'pandas.core.frame.DataFrame'>
Int64Index: 6810 entries, 20171116 to 20181130
Columns: 2037 entries, (10MA/20MA-1) to vol0
dtypes: float16(1987), float64(44), int64(1), uint8(5)
memory usage: 28.2 MB
None
===== (6810,) (6810,)
          y_l_rise  y_l_decline  y_l_avg  y_s_rise  y_s_decline  y_s_avg  y_l  \
date
20170522       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170703       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171123       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171106       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170915       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20181120       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20181213       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20180404       0.0          0.0      NaN       0.0          0.0      NaN  0.0

          y_l_r
date
20170522    0.0
20170703    0.0
20171123    0.0
20171106    0.0
20170915    0.0
20181120    0.0
20181213    0.0
20180404    0.0
(4731, 2036) (1484, 2036)
          y_l_rise  y_l_decline   y_l_avg  y_s_rise  y_s_decline   y_s_avg  \
date
20180702  0.047312    -0.163978 -0.068203  0.047312    -0.075806 -0.015995
20180702  0.165563    -0.033113  0.049453  0.039735    -0.033113 -0.000888
20180702  0.008969    -0.266816 -0.147618  0.008969    -0.118834 -0.045511
20180702  0.152809    -0.056180  0.055038  0.044944    -0.056180  0.004933
20180702  0.035185    -0.148148 -0.037396  0.016667    -0.148148 -0.061408
20180702  0.108163    -0.106122 -0.006134  0.028571    -0.093878 -0.016856
20180702  0.086592    -0.143855  0.004350  0.025140    -0.053073 -0.005898
20180702  0.106218    -0.077720  0.022556  0.039896    -0.077720 -0.016733
20180702  0.070423    -0.070423 -0.001644  0.009577    -0.070423 -0.022191
20180702  0.218097    -0.073086  0.043194  0.017401    -0.071926 -0.020303
20180702  0.058115    -0.055160  0.001152  0.005051    -0.050505 -0.015889
20180702  0.159667    -0.061807  0.052275  0.043978    -0.061807 -0.006260
20180702  0.140932    -0.052753  0.037754  0.062380    -0.038891  0.012364
20180702  0.065038    -0.120611 -0.018995  0.000000    -0.120611 -0.065893
20180702  0.012158    -0.144883 -0.067281  0.012158    -0.144883 -0.077498
20180702  0.184739    -0.013047  0.087529  0.080583    -0.013047  0.048225
20180702  0.116920    -0.068441  0.021932  0.024715    -0.068441  0.000435
20180702  0.087709    -0.161370 -0.013477  0.062248    -0.075680  0.004469
20180703  0.013294    -0.090039 -0.038908  0.013294    -0.088626 -0.040594
20180703  0.109716    -0.030568  0.048833  0.079148    -0.030568  0.026238

               y_l     y_l_r
date
20180702 -0.163978 -0.122984
20180702  0.165563  0.124172
20180702 -0.266816 -0.200112
20180702  0.152809  0.114607
20180702 -0.148148 -0.111111
20180702  0.108163 -0.079592
20180702 -0.143855  0.064944
20180702  0.106218  0.079663
20180702 -0.070423 -0.052817
20180702  0.218097  0.163573
20180702  0.058115  0.043586
20180702  0.159667  0.119750
20180702  0.140932  0.105699
20180702 -0.120611 -0.090458
20180702 -0.144883 -0.108663
20180702  0.184739  0.138554
20180702  0.116920  0.087690
20180702 -0.161370 -0.121027
20180703 -0.090039 -0.067529
20180703  0.109716  0.082287

--------------------Train network--------------------

 (4731, 2036) (4731,) {'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}, 'train_indexes': (0, None)}

----------Train layer 0----------
slice(0, None, None)

Train l2_y_l
C:\ProgramData\Anaconda3\lib\site-packages\lightgbm\basic.py:1042: UserWarning: categorical_feature in Dataset is overridden. New categorical_feature is ['area', 'exchange', 'is_hs', 'market']
  warnings.warn('categorical_feature in Dataset is overridden. New categorical_feature is {}'.format(sorted(list(categorical_feature))))
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
Time usage: 22.01s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.1, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=50,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                   feature  importance_raw  importance_percent
568                                   area              23                1.55
2025                                sz_vol              19                1.28
1351          p480mv_upper_shadow/120k_avg              13                0.88
895                              hs300_vol              12                0.81
1865                              sz50_vol              12                0.81
567                                    amt              10                0.67
1461      p60mv_(20k_high-20k_low)/20k_avg               9                0.61
1074           p180mv_lower_shadow/60k_avg               9                0.61
937     p100mv_(20k_open/p20mv_20k_open-1)               7                0.47
1428                 p5mv_(high-close)/avg               7                0.47
1460    p60mv_(20k_high-20k_close)/20k_avg               7                0.47
1705                                sh_vol               7                0.47
1026          p12mv_(3k_low/p3mv_3k_low-1)               7                0.47
1285           p3mv_(3k_low/p3mv_3k_low-1)               6                0.40
160              (20k_vol/p60mv_20k_vol-1)               6                0.40
1170           p240mv_lower_shadow/60k_avg               6                0.40
1350          p480mv_lower_shadow/120k_avg               6                0.40
53               (10k_vol/p50mv_10k_vol-1)               6                0.40
1166      p240mv_(60k_low/p60mv_60k_low-1)               6                0.40
1446  p600mv_(120k_high-120k_low)/120k_avg               6                0.40
Among 2036 features, 1291 features are not used in the model

--------------------Predict--------------------

----------Layer 0 predicts----------

y_l_r
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      4     -0.022       -0.006     0.197     0.154    -0.232
(-0.10,-0.05]     61     -0.063       -0.087     0.113     0.192    -0.348
(-0.05,0.00]     542     -0.017       -0.046     0.119     0.623    -0.304
(0.00,0.05]      682     -0.004       -0.030     0.118     0.522    -0.323
(0.05,0.10]      181      0.023        0.055     0.134     0.398    -0.263
(0.10,0.15]       14      0.028        0.064     0.142     0.289    -0.188
(0.15,0.20]        0        NaN          NaN       NaN       NaN       NaN
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      4     -0.030       -0.008     0.262     0.205    -0.309
(-0.10,-0.05]     61     -0.081       -0.117     0.154     0.256    -0.463
(-0.05,0.00]     542     -0.025       -0.069     0.159     0.830    -0.406
(0.00,0.05]      682     -0.012       -0.063     0.158     0.696    -0.430
(0.05,0.10]      181      0.019       -0.057     0.181     0.530    -0.351
(0.10,0.15]       14      0.037        0.086     0.189     0.385    -0.250
(0.15,0.20]        0        NaN          NaN       NaN       NaN       NaN
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_avg
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      4     -0.050       -0.051     0.125     0.091    -0.189
(-0.10,-0.05]     61     -0.037       -0.035     0.079     0.151    -0.331
(-0.05,0.00]     542     -0.007       -0.009     0.074     0.556    -0.274
(0.00,0.05]      682     -0.002       -0.001     0.071     0.383    -0.347
(0.05,0.10]      181      0.017        0.004     0.082     0.309    -0.154
(0.10,0.15]       14      0.022        0.013     0.084     0.184    -0.114
(0.15,0.20]        0        NaN          NaN       NaN       NaN       NaN
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

























C:\ProgramData\Anaconda3\python.exe C:/Users/Administrator/Documents/Projects/Quant/DM/ml_model.py
2016-01-01 2018-12-31
Time slice keys in hdf5: 2016/0101-0101,2017/0101-0101,2018/0101-0101

Current key: 2016/0101-0101
Current slice size(length): 313767
Current subsample size(length): 6275

Current key: 2017/0101-0101
Current slice size(length): 333371
Current subsample size(length): 6667

Current key: 2018/0101-0101
Current slice size(length): 347712
Current subsample size(length): 6954

Total concatenating size: 19896
Result dataset size: 19896
<class 'pandas.core.frame.DataFrame'>
Int64Index: 19896 entries, 20161215 to 20181130
Columns: 2037 entries, (10MA/20MA-1) to vol0
dtypes: float16(1987), float64(44), int64(1), uint8(5)
memory usage: 82.5 MB
None
===== (19896,) (19896,)
          y_l_rise  y_l_decline  y_l_avg  y_s_rise  y_s_decline  y_s_avg  y_l  \
date
20161205       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161128       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161216       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170522       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170703       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170925       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171123       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171106       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170915       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171009       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20180119       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20181120       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20181213       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20180918       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20180404       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20181226       0.0          0.0      NaN       0.0          0.0      NaN  0.0

          y_l_r
date
20161205    0.0
20161128    0.0
20161216    0.0
20170522    0.0
20170703    0.0
20170925    0.0
20171123    0.0
20171106    0.0
20170915    0.0
20171009    0.0
20180119    0.0
20181120    0.0
20181213    0.0
20180918    0.0
20180404    0.0
20181226    0.0
(15755, 2036) (2959, 2036)
          y_l_rise  y_l_decline   y_l_avg  y_s_rise  y_s_decline   y_s_avg  \
date
20180702  0.047312    -0.163978 -0.068203  0.047312    -0.075806 -0.015995
20180702  0.165563    -0.033113  0.049453  0.039735    -0.033113 -0.000888
20180702  0.008969    -0.266816 -0.147618  0.008969    -0.118834 -0.045511
20180702  0.152809    -0.056180  0.055038  0.044944    -0.056180  0.004933
20180702  0.035185    -0.148148 -0.037396  0.016667    -0.148148 -0.061408
20180702  0.108163    -0.106122 -0.006134  0.028571    -0.093878 -0.016856
20180702  0.086592    -0.143855  0.004350  0.025140    -0.053073 -0.005898
20180702  0.106218    -0.077720  0.022556  0.039896    -0.077720 -0.016733
20180702  0.070423    -0.070423 -0.001644  0.009577    -0.070423 -0.022191
20180702  0.218097    -0.073086  0.043194  0.017401    -0.071926 -0.020303
20180702  0.058115    -0.055160  0.001152  0.005051    -0.050505 -0.015889
20180702  0.159667    -0.061807  0.052275  0.043978    -0.061807 -0.006260
20180702  0.140932    -0.052753  0.037754  0.062380    -0.038891  0.012364
20180702  0.065038    -0.120611 -0.018995  0.000000    -0.120611 -0.065893
20180702  0.012158    -0.144883 -0.067281  0.012158    -0.144883 -0.077498
20180702  0.184739    -0.013047  0.087529  0.080583    -0.013047  0.048225
20180702  0.116920    -0.068441  0.021932  0.024715    -0.068441  0.000435
20180702  0.087709    -0.161370 -0.013477  0.062248    -0.075680  0.004469
20180702  0.086323    -0.058296  0.009872  0.047085    -0.022422  0.009420
20180702  0.072833    -0.076923  0.013880  0.020000    -0.076923 -0.014639

               y_l     y_l_r
date
20180702 -0.163978 -0.122984
20180702  0.165563  0.124172
20180702 -0.266816 -0.200112
20180702  0.152809  0.114607
20180702 -0.148148 -0.111111
20180702  0.108163 -0.079592
20180702 -0.143855  0.064944
20180702  0.106218  0.079663
20180702 -0.070423 -0.052817
20180702  0.218097  0.163573
20180702  0.058115  0.043586
20180702  0.159667  0.119750
20180702  0.140932  0.105699
20180702 -0.120611 -0.090458
20180702 -0.144883 -0.108663
20180702  0.184739  0.138554
20180702  0.116920  0.087690
20180702 -0.161370 -0.121027
20180702  0.086323  0.064742
20180702 -0.076923  0.054624

--------------------Train network--------------------

 (15755, 2036) (15755,) {'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}, 'train_indexes': (0, None)}

----------Train layer 0----------
slice(0, None, None)

Train l2_y_l
C:\ProgramData\Anaconda3\lib\site-packages\lightgbm\basic.py:1042: UserWarning: categorical_feature in Dataset is overridden. New categorical_feature is ['area', 'exchange', 'is_hs', 'market']
  warnings.warn('categorical_feature in Dataset is overridden. New categorical_feature is {}'.format(sorted(list(categorical_feature))))
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 26.58s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.1, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=50,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                 feature  importance_raw  importance_percent
732                              cyb_vol              74                4.93
1116    p20mv_(20k_high-20k_low)/20k_avg              47                3.13
895                            hs300_vol              40                2.67
2034                                 vol              37                2.47
1865                            sz50_vol              37                2.47
478                  (high/p5min_high-1)              36                2.40
2025                              sz_vol              28                1.87
939          p100mv_lower_shadow/20k_avg              21                1.40
1460  p60mv_(20k_high-20k_close)/20k_avg              20                1.33
2035                                vol0              20                1.33
287            (5k_high-5k_close)/5k_avg              19                1.27
302              (5k_low/p25mv_5k_low-1)              19                1.27
36                   (10k_low/20k_low-1)              19                1.27
1103    p20mv_(10k_high-10k_low)/10k_avg              18                1.20
246              (3k_low/p15mv_3k_low-1)              17                1.13
176         (250k_avg/p750mv_250k_avg-1)              17                1.13
458                (high/p10mean_high-1)              17                1.13
568                                 area              16                1.07
18          (10k_close-10k_open)/10k_avg              16                1.07
180     (250k_close/p250mv_250k_close-1)              16                1.07
Among 2036 features, 1588 features are not used in the model

--------------------Predict--------------------

----------Layer 0 predicts----------

y_l_r
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     21     -0.052       -0.058     0.108     0.184    -0.179
(-0.05,0.00]     440     -0.045       -0.074     0.111     0.263    -0.348
(0.00,0.05]     2165     -0.007       -0.032     0.117     0.676    -0.508
(0.05,0.10]      300      0.025        0.046     0.148     0.607    -0.256
(0.10,0.15]       30      0.086        0.094     0.144     0.522    -0.244
(0.15,0.20]        3     -0.011       -0.064     0.104     0.108    -0.078
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     21     -0.070       -0.077     0.144     0.245    -0.239
(-0.05,0.00]     440     -0.064       -0.103     0.147     0.351    -0.463
(0.00,0.05]     2165     -0.013       -0.057     0.157     0.901    -0.677
(0.05,0.10]      300      0.029        0.022     0.199     0.810    -0.341
(0.10,0.15]       30      0.101        0.126     0.200     0.696    -0.326
(0.15,0.20]        3     -0.015       -0.085     0.138     0.144    -0.105
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_avg
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     21     -0.039       -0.026     0.072     0.094    -0.149
(-0.05,0.00]     440     -0.025       -0.025     0.069     0.212    -0.347
(0.00,0.05]     2165     -0.003       -0.002     0.072     0.532    -0.538
(0.05,0.10]      300      0.020        0.003     0.091     0.556    -0.236
(0.10,0.15]       30      0.042        0.049     0.099     0.383    -0.174
(0.15,0.20]        3     -0.008       -0.025     0.038     0.036    -0.034
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

Process finished with exit code -1





















C:\ProgramData\Anaconda3\python.exe C:/Users/Administrator/Documents/Projects/Quant/DM/ml_model.py
2015-01-01 2018-12-31
Time slice keys in hdf5: 2015/0101-0101,2016/0101-0101,2017/0101-0101,2018/0101-0101

Current key: 2015/0101-0101
Current slice size(length): 304680
Current subsample size(length): 6093

Current key: 2016/0101-0101
Current slice size(length): 313767
Current subsample size(length): 6275

Current key: 2017/0101-0101
Current slice size(length): 333371
Current subsample size(length): 6667

Current key: 2018/0101-0101
Current slice size(length): 347712
Current subsample size(length): 6954

Total concatenating size: 25989
Result dataset size: 25989
<class 'pandas.core.frame.DataFrame'>
Int64Index: 25989 entries, 20150625 to 20181130
Columns: 2037 entries, (10MA/20MA-1) to vol0
dtypes: float16(1987), float64(44), int64(1), uint8(5)
memory usage: 107.7 MB
None
===== (25989,) (25989,)
          y_l_rise  y_l_decline   y_l_avg  y_s_rise  y_s_decline   y_s_avg  \
date
20150625  0.326140    -0.094218  0.130063  0.092077    -0.094218  0.011305
20150625  0.184131    -0.171007  0.006162  0.037957    -0.164345 -0.045155
20150625  0.155993    -0.409027 -0.124840  0.155993    -0.128900  0.031896
20150625  0.107900    -0.457064 -0.151295  0.007339    -0.269908 -0.140052
20150625  0.029046    -0.412863 -0.246715  0.029046    -0.260581 -0.123347
20150625  0.027808    -0.445664 -0.246340  0.027808    -0.244054 -0.111461
20150625  0.086731    -0.290615 -0.123911  0.086731    -0.107120 -0.015056
20150625  0.377984    -0.259416  0.032705  0.031300    -0.259416 -0.078443
20150625  0.030634    -0.459205 -0.246381  0.030634    -0.263573 -0.144264
20150625  0.013865    -0.320624 -0.146790  0.000000    -0.249567 -0.130389
20150625  0.024306    -0.575810 -0.348144  0.024306    -0.282986 -0.124545
20150625  0.000000    -0.373750 -0.185832  0.000000    -0.234583 -0.117872
20150625  0.071429    -0.276429 -0.079868  0.017143    -0.160714 -0.049976
20150625  0.000000    -0.400364 -0.213642  0.000000    -0.263876 -0.157532
20150625  0.000000    -0.455556 -0.186822  0.000000    -0.238889 -0.115945
20150625  0.000000    -0.537082 -0.272713  0.000000    -0.290177 -0.174582
20150625  0.045455    -0.476349 -0.253871  0.045455    -0.221380 -0.076939
20150625  0.000000    -0.446303 -0.184260  0.000000    -0.252593 -0.137745
20150625  0.027273    -0.515810 -0.279371  0.027273    -0.203557 -0.075446
20151110  0.257514    -0.005566  0.130359  0.174397    -0.005566  0.098284

               y_l     y_l_r
date
20150625  0.326140  0.244605
20150625  0.184131  0.138098
20150625 -0.409027 -0.306770
20150625 -0.457064 -0.342798
20150625 -0.412863 -0.309647
20150625 -0.445664 -0.334248
20150625 -0.290615 -0.217961
20150625  0.377984  0.283488
20150625 -0.459205 -0.344404
20150625 -0.320624 -0.240468
20150625 -0.575810 -0.431858
20150625 -0.373750 -0.280313
20150625 -0.276429 -0.207321
20150625 -0.400364 -0.300273
20150625 -0.455556 -0.341667
20150625 -0.537082 -0.402812
20150625 -0.476349 -0.357262
20150625 -0.446303 -0.334727
20150625 -0.515810 -0.386858
20151110  0.257514  0.193135
(21848, 2036) (2959, 2036)
          y_l_rise  y_l_decline   y_l_avg  y_s_rise  y_s_decline   y_s_avg  \
date
20180702  0.047312    -0.163978 -0.068203  0.047312    -0.075806 -0.015995
20180702  0.165563    -0.033113  0.049453  0.039735    -0.033113 -0.000888
20180702  0.008969    -0.266816 -0.147618  0.008969    -0.118834 -0.045511
20180702  0.152809    -0.056180  0.055038  0.044944    -0.056180  0.004933
20180702  0.035185    -0.148148 -0.037396  0.016667    -0.148148 -0.061408
20180702  0.108163    -0.106122 -0.006134  0.028571    -0.093878 -0.016856
20180702  0.086592    -0.143855  0.004350  0.025140    -0.053073 -0.005898
20180702  0.106218    -0.077720  0.022556  0.039896    -0.077720 -0.016733
20180702  0.070423    -0.070423 -0.001644  0.009577    -0.070423 -0.022191
20180702  0.218097    -0.073086  0.043194  0.017401    -0.071926 -0.020303
20180702  0.058115    -0.055160  0.001152  0.005051    -0.050505 -0.015889
20180702  0.159667    -0.061807  0.052275  0.043978    -0.061807 -0.006260
20180702  0.140932    -0.052753  0.037754  0.062380    -0.038891  0.012364
20180702  0.065038    -0.120611 -0.018995  0.000000    -0.120611 -0.065893
20180702  0.012158    -0.144883 -0.067281  0.012158    -0.144883 -0.077498
20180702  0.184739    -0.013047  0.087529  0.080583    -0.013047  0.048225
20180702  0.116920    -0.068441  0.021932  0.024715    -0.068441  0.000435
20180702  0.087709    -0.161370 -0.013477  0.062248    -0.075680  0.004469
20180702  0.086323    -0.058296  0.009872  0.047085    -0.022422  0.009420
20180702  0.072833    -0.076923  0.013880  0.020000    -0.076923 -0.014639

               y_l     y_l_r
date
20180702 -0.163978 -0.140035
20180702  0.165563  0.136535
20180702 -0.266816 -0.237017
20180702  0.152809  0.128366
20180702 -0.148148 -0.120460
20180702  0.108163 -0.081125
20180702 -0.143855  0.066032
20180702  0.106218  0.085302
20180702 -0.070423 -0.053228
20180702  0.218097  0.174372
20180702  0.058115  0.043874
20180702  0.159667  0.132819
20180702  0.140932  0.115137
20180702 -0.120611 -0.095207
20180702 -0.144883 -0.125483
20180702  0.184739  0.160437
20180702  0.116920  0.093173
20180702 -0.161370 -0.124396
20180702  0.086323  0.067210
20180702 -0.076923  0.058094

--------------------Train network--------------------

 (21848, 2036) (21848,) {'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}, 'train_indexes': (0, None)}

----------Train layer 0----------
slice(0, None, None)

Train l2_y_l
C:\ProgramData\Anaconda3\lib\site-packages\lightgbm\basic.py:1042: UserWarning: categorical_feature in Dataset is overridden. New categorical_feature is ['area', 'exchange', 'is_hs', 'market']
  warnings.warn('categorical_feature in Dataset is overridden. New categorical_feature is {}'.format(sorted(list(categorical_feature))))
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 34.64s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.1, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=50,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                feature  importance_raw  importance_percent
2034                                vol              70                4.67
2025                             sz_vol              55                3.67
939         p100mv_lower_shadow/20k_avg              46                3.07
1865                           sz50_vol              44                2.93
1138         p20mv_lower_shadow/20k_avg              43                2.87
1705                             sh_vol              42                2.80
1480  p60mv_(60k_open/p60mv_60k_open-1)              40                2.67
518               (open/p120min_open-1)              40                2.67
567                                 amt              39                2.60
102               (120k_vol/250k_vol-1)              37                2.47
478                 (high/p5min_high-1)              37                2.47
1268       p360mv_lower_shadow/120k_avg              36                2.40
895                           hs300_vol              36                2.40
27          (10k_high-10k_open)/10k_avg              35                2.33
522                (open/p20min_open-1)              35                2.33
170        (250k_amt/p500mv_250k_amt-1)              35                2.33
1312   p40mv_(10k_high-10k_low)/10k_avg              34                2.27
904                 lower_shadow/3k_avg              33                2.20
1303           p3mv_lower_shadow/3k_avg              33                2.20
155         (20k_open/p80mv_20k_open-1)              33                2.20
Among 2036 features, 1786 features are not used in the model

--------------------Predict--------------------

----------Layer 0 predicts----------

y_l_r
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]      0        NaN          NaN       NaN       NaN       NaN
(-0.05,0.00]     172     -0.053       -0.066     0.118     0.275    -0.346
(0.00,0.05]     2442     -0.010       -0.042     0.133     0.809    -0.561
(0.05,0.10]      302      0.011        0.045     0.180     0.617    -0.643
(0.10,0.15]       42      0.079        0.093     0.192     0.536    -0.291
(0.15,0.20]        1      0.331        0.331       NaN     0.331     0.331
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]      0        NaN          NaN       NaN       NaN       NaN
(-0.05,0.00]     172     -0.064       -0.080     0.135     0.304    -0.371
(0.00,0.05]     2442     -0.017       -0.064     0.155     0.901    -0.599
(0.05,0.10]      302      0.007       -0.050     0.209     0.696    -0.677
(0.10,0.15]       42      0.073        0.098     0.234     0.622    -0.351
(0.15,0.20]        1      0.373        0.373       NaN     0.373     0.373
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_avg
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]      0        NaN          NaN       NaN       NaN       NaN
(-0.05,0.00]     172     -0.027       -0.020     0.067     0.187    -0.273
(0.00,0.05]     2442     -0.004       -0.004     0.071     0.556    -0.446
(0.05,0.10]      302      0.007        0.005     0.102     0.383    -0.538
(0.10,0.15]       42      0.039        0.025     0.098     0.281    -0.130
(0.15,0.20]        1      0.202        0.202       NaN     0.202     0.202
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN



























Y["y_l_r"]= Y.apply(
        lambda r: r["y_l_rise"]
        if r["y_l_avg"] > 0 else r["y_l_decline"],
        axis=1)*0.75  + 0.25 * Y["y_l_avg"].values
C:\ProgramData\Anaconda3\python.exe C:/Users/Administrator/Documents/Projects/Quant/DM/ml_model.py
2017-01-01 2018-12-31
Time slice keys in hdf5: 2017/0101-0101,2018/0101-0101

Current key: 2017/0101-0101
Current slice size(length): 333371
Current subsample size(length): 6667

Current key: 2018/0101-0101
Current slice size(length): 347712
Current subsample size(length): 6954

Total concatenating size: 13621
Result dataset size: 13621
<class 'pandas.core.frame.DataFrame'>
Int64Index: 13621 entries, 20171116 to 20181130
Columns: 2037 entries, (10MA/20MA-1) to vol0
dtypes: float16(1987), float64(44), int64(1), uint8(5)
memory usage: 56.5 MB
None
(9480, 2036) (2959, 2036)
          y_l_rise  y_l_decline   y_l_avg  y_s_rise  y_s_decline   y_s_avg  \
date
20180702  0.047312    -0.163978 -0.068203  0.047312    -0.075806 -0.015995
20180702  0.165563    -0.033113  0.049453  0.039735    -0.033113 -0.000888
20180702  0.008969    -0.266816 -0.147618  0.008969    -0.118834 -0.045511
20180702  0.152809    -0.056180  0.055038  0.044944    -0.056180  0.004933
20180702  0.035185    -0.148148 -0.037396  0.016667    -0.148148 -0.061408
20180702  0.108163    -0.106122 -0.006134  0.028571    -0.093878 -0.016856
20180702  0.086592    -0.143855  0.004350  0.025140    -0.053073 -0.005898
20180702  0.106218    -0.077720  0.022556  0.039896    -0.077720 -0.016733
20180702  0.070423    -0.070423 -0.001644  0.009577    -0.070423 -0.022191
20180702  0.218097    -0.073086  0.043194  0.017401    -0.071926 -0.020303
20180702  0.058115    -0.055160  0.001152  0.005051    -0.050505 -0.015889
20180702  0.159667    -0.061807  0.052275  0.043978    -0.061807 -0.006260
20180702  0.140932    -0.052753  0.037754  0.062380    -0.038891  0.012364
20180702  0.065038    -0.120611 -0.018995  0.000000    -0.120611 -0.065893
20180702  0.012158    -0.144883 -0.067281  0.012158    -0.144883 -0.077498
20180702  0.184739    -0.013047  0.087529  0.080583    -0.013047  0.048225
20180702  0.116920    -0.068441  0.021932  0.024715    -0.068441  0.000435
20180702  0.087709    -0.161370 -0.013477  0.062248    -0.075680  0.004469
20180702  0.086323    -0.058296  0.009872  0.047085    -0.022422  0.009420
20180702  0.072833    -0.076923  0.013880  0.020000    -0.076923 -0.014639

               y_l     y_l_r
date
20180702 -0.163978 -0.140035
20180702  0.165563  0.136535
20180702 -0.266816 -0.237017
20180702  0.152809  0.128366
20180702 -0.148148 -0.120460
20180702  0.108163 -0.081125
20180702 -0.143855  0.066032
20180702  0.106218  0.085302
20180702 -0.070423 -0.053228
20180702  0.218097  0.174372
20180702  0.058115  0.043874
20180702  0.159667  0.132819
20180702  0.140932  0.115137
20180702 -0.120611 -0.095207
20180702 -0.144883 -0.125483
20180702  0.184739  0.160437
20180702  0.116920  0.093173
20180702 -0.161370 -0.124396
20180702  0.086323  0.067210
20180702 -0.076923  0.058094

--------------------Train network--------------------

 (9480, 2036) (9480,) {'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}, 'train_indexes': (0, None)}

----------Train layer 0----------
slice(0, None, None)

Train l2_y_l
C:\ProgramData\Anaconda3\lib\site-packages\lightgbm\basic.py:1042: UserWarning: categorical_feature in Dataset is overridden. New categorical_feature is ['area', 'exchange', 'is_hs', 'market']
  warnings.warn('categorical_feature in Dataset is overridden. New categorical_feature is {}'.format(sorted(list(categorical_feature))))
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 19.67s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.1, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=50,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                    feature  importance_raw  \
732                                 cyb_vol              80
969              p10mv_upper_shadow/10k_avg              45
448                   (close/p5min_close-1)              44
1461       p60mv_(20k_high-20k_low)/20k_avg              42
1452  p600mv_(120k_open/p120mv_120k_open-1)              40
343             (60k_high-60k_open)/60k_avg              39
981     p120mv_(120k_low/p120mv_120k_low-1)              39
287               (5k_high-5k_close)/5k_avg              38
1469        p60mv_(60k_amt/p60mv_60k_amt-1)              37
1102     p20mv_(10k_high-10k_close)/10k_avg              37
1479        p60mv_(60k_low/p60mv_60k_low-1)              37
234                 (3k_high-3k_low)/3k_avg              36
1303               p3mv_lower_shadow/3k_avg              36
2028                   upper_shadow/20k_avg              36
1160    p240mv_(60k_high-60k_close)/60k_avg              36
1187           p250mv_upper_shadow/250k_avg              36
185          (250k_high-250k_open)/250k_avg              36
1480      p60mv_(60k_open/p60mv_60k_open-1)              35
987    p120mv_(60k_close/p60mv_60k_close-1)              35
1048        p15mv_(5k_high-5k_close)/5k_avg              35

      importance_percent
732                 5.33
969                 3.00
448                 2.93
1461                2.80
1452                2.67
343                 2.60
981                 2.60
287                 2.53
1469                2.47
1102                2.47
1479                2.47
234                 2.40
1303                2.40
2028                2.40
1160                2.40
1187                2.40
185                 2.40
1480                2.33
987                 2.33
1048                2.33
Among 2036 features, 1779 features are not used in the model

--------------------Predict--------------------

----------Layer 0 predicts----------

y_l_r
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     19     -0.037       -0.064     0.123     0.176    -0.291
(-0.05,0.00]     747     -0.030       -0.051     0.129     0.809    -0.430
(0.00,0.05]     2132     -0.003       -0.035     0.142     0.746    -0.643
(0.05,0.10]       61      0.024        0.062     0.146     0.418    -0.245
(0.10,0.15]        0        NaN          NaN       NaN       NaN       NaN
(0.15,0.20]        0        NaN          NaN       NaN       NaN       NaN
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     19     -0.043       -0.076     0.142     0.205    -0.317
(-0.05,0.00]     747     -0.038       -0.066     0.149     0.901    -0.463
(0.00,0.05]     2132     -0.009       -0.064     0.166     0.810    -0.677
(0.05,0.10]       61      0.018       -0.043     0.173     0.474    -0.270
(0.10,0.15]        0        NaN          NaN       NaN       NaN       NaN
(0.15,0.20]        0        NaN          NaN       NaN       NaN       NaN
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_avg
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     19     -0.021       -0.003     0.071     0.091    -0.215
(-0.05,0.00]     747     -0.012       -0.010     0.073     0.532    -0.331
(0.00,0.05]     2132     -0.001       -0.002     0.076     0.556    -0.538
(0.05,0.10]       61      0.017        0.003     0.072     0.247    -0.171
(0.10,0.15]        0        NaN          NaN       NaN       NaN       NaN
(0.15,0.20]        0        NaN          NaN       NaN       NaN       NaN
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN











C:\ProgramData\Anaconda3\python.exe C:/Users/Administrator/Documents/Projects/Quant/DM/ml_model.py
2013-01-01 2018-12-31
Time slice keys in hdf5: 2013/0101-0101,2014/0101-0101,2015/0101-0101,2016/0101-0101,2017/0101-0101,2018/0101-0101

Current key: 2013/0101-0101
Current slice size(length): 278061
Current subsample size(length): 5561

Current key: 2014/0101-0101
Current slice size(length): 291574
Current subsample size(length): 5831

Current key: 2015/0101-0101
Current slice size(length): 304680
Current subsample size(length): 6093

Current key: 2016/0101-0101
Current slice size(length): 313767
Current subsample size(length): 6275

Current key: 2017/0101-0101
Current slice size(length): 333371
Current subsample size(length): 6667

Current key: 2018/0101-0101
Current slice size(length): 347712
Current subsample size(length): 6954

Total concatenating size: 37381
Result dataset size: 37381
<class 'pandas.core.frame.DataFrame'>
Int64Index: 37381 entries, 20130402 to 20181130
Columns: 2037 entries, (10MA/20MA-1) to vol0
dtypes: float16(1987), float64(44), int64(1), uint8(5)
memory usage: 155.0 MB
None
(33240, 2036) (2959, 2036)
          y_l_rise  y_l_decline   y_l_avg  y_s_rise  y_s_decline   y_s_avg  \
date
20180702  0.047312    -0.163978 -0.068203  0.047312    -0.075806 -0.015995
20180702  0.165563    -0.033113  0.049453  0.039735    -0.033113 -0.000888
20180702  0.008969    -0.266816 -0.147618  0.008969    -0.118834 -0.045511
20180702  0.152809    -0.056180  0.055038  0.044944    -0.056180  0.004933
20180702  0.035185    -0.148148 -0.037396  0.016667    -0.148148 -0.061408
20180702  0.108163    -0.106122 -0.006134  0.028571    -0.093878 -0.016856
20180702  0.086592    -0.143855  0.004350  0.025140    -0.053073 -0.005898
20180702  0.106218    -0.077720  0.022556  0.039896    -0.077720 -0.016733
20180702  0.070423    -0.070423 -0.001644  0.009577    -0.070423 -0.022191
20180702  0.218097    -0.073086  0.043194  0.017401    -0.071926 -0.020303
20180702  0.058115    -0.055160  0.001152  0.005051    -0.050505 -0.015889
20180702  0.159667    -0.061807  0.052275  0.043978    -0.061807 -0.006260
20180702  0.140932    -0.052753  0.037754  0.062380    -0.038891  0.012364
20180702  0.065038    -0.120611 -0.018995  0.000000    -0.120611 -0.065893
20180702  0.012158    -0.144883 -0.067281  0.012158    -0.144883 -0.077498
20180702  0.184739    -0.013047  0.087529  0.080583    -0.013047  0.048225
20180702  0.116920    -0.068441  0.021932  0.024715    -0.068441  0.000435
20180702  0.087709    -0.161370 -0.013477  0.062248    -0.075680  0.004469
20180702  0.086323    -0.058296  0.009872  0.047085    -0.022422  0.009420
20180702  0.072833    -0.076923  0.013880  0.020000    -0.076923 -0.014639

               y_l     y_l_r
date
20180702 -0.163978 -0.140035
20180702  0.165563  0.136535
20180702 -0.266816 -0.237017
20180702  0.152809  0.128366
20180702 -0.148148 -0.120460
20180702  0.108163 -0.081125
20180702 -0.143855  0.066032
20180702  0.106218  0.085302
20180702 -0.070423 -0.053228
20180702  0.218097  0.174372
20180702  0.058115  0.043874
20180702  0.159667  0.132819
20180702  0.140932  0.115137
20180702 -0.120611 -0.095207
20180702 -0.144883 -0.125483
20180702  0.184739  0.160437
20180702  0.116920  0.093173
20180702 -0.161370 -0.124396
20180702  0.086323  0.067210
20180702 -0.076923  0.058094

--------------------Train network--------------------

 (33240, 2036) (33240,) {'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}, 'train_indexes': (0, None)}

----------Train layer 0----------
slice(0, None, None)

Train l2_y_l
C:\ProgramData\Anaconda3\lib\site-packages\lightgbm\basic.py:1042: UserWarning: categorical_feature in Dataset is overridden. New categorical_feature is ['area', 'exchange', 'is_hs', 'market']
  warnings.warn('categorical_feature in Dataset is overridden. New categorical_feature is {}'.format(sorted(list(categorical_feature))))
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 31.80s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.1, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=50,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                    feature  importance_raw  \
1865                               sz50_vol              95
2025                                 sz_vol              60
1088                    p1mv_(high-low)/avg              50
2034                                    vol              34
939             p100mv_lower_shadow/20k_avg              34
453                        (high-close)/avg              33
986     p120mv_(60k_close-60k_open)/60k_avg              32
937      p100mv_(20k_open/p20mv_20k_open-1)              32
1390        p50mv_(10k_avg/p10mv_10k_avg-1)              30
69             (120k_avg/p360mv_120k_avg-1)              29
519                      (open/p1mv_open-1)              29
349             (60k_high/p60mv_60k_high-1)              29
732                                 cyb_vol              29
1386    p500mv_(250k_vol/p250mv_250k_vol-1)              28
197            (250k_low/p750mv_250k_low-1)              28
1381  p500mv_(250k_high/p250mv_250k_high-1)              28
1312       p40mv_(10k_high-10k_low)/10k_avg              28
1261  p360mv_(120k_high-120k_open)/120k_avg              27
989       p120mv_(60k_high-60k_low)/60k_avg              27
183         (250k_high-250k_close)/250k_avg              26

      importance_percent
1865                6.33
2025                4.00
1088                3.33
2034                2.27
939                 2.27
453                 2.20
986                 2.13
937                 2.13
1390                2.00
69                  1.93
519                 1.93
349                 1.93
732                 1.93
1386                1.87
197                 1.87
1381                1.87
1312                1.87
1261                1.80
989                 1.80
183                 1.73
Among 2036 features, 1722 features are not used in the model

--------------------Predict--------------------

----------Layer 0 predicts----------

y_l_r
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]      0        NaN          NaN       NaN       NaN       NaN
(-0.05,0.00]      81     -0.028        0.000     0.125     0.302    -0.291
(0.00,0.05]     2347     -0.016       -0.046     0.131     0.809    -0.643
(0.05,0.10]      426      0.008        0.049     0.158     0.501    -0.373
(0.10,0.15]       98      0.063        0.097     0.205     0.617    -0.288
(0.15,0.20]        7      0.213        0.226     0.192     0.478    -0.151
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]      0        NaN          NaN       NaN       NaN       NaN
(-0.05,0.00]      81     -0.029        0.000     0.145     0.332    -0.317
(0.00,0.05]     2347     -0.023       -0.067     0.153     0.901    -0.677
(0.05,0.10]      426      0.002       -0.064     0.185     0.580    -0.406
(0.10,0.15]       98      0.066        0.127     0.241     0.696    -0.326
(0.15,0.20]        7      0.186        0.251     0.294     0.577    -0.250
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_avg
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]      0        NaN          NaN       NaN       NaN       NaN
(-0.05,0.00]      81     -0.012        0.000     0.072     0.214    -0.215
(0.00,0.05]     2347     -0.007       -0.006     0.071     0.556    -0.538
(0.05,0.10]      426      0.005        0.004     0.083     0.358    -0.274
(0.10,0.15]       98      0.032        0.032     0.110     0.383    -0.189
(0.15,0.20]        7      0.110        0.142     0.106     0.202    -0.101
(0.20,0.25]        0        NaN          NaN       NaN       NaN       NaN
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

Process finished with exit code 0











fit y_l_r
Y["y_l_r"]= Y.apply(
        lambda r: r["y_l_rise"]
        if r["y_l_avg"] > 0 else r["y_l_decline"],
        axis=1)*0.75 + 0.25 * Y["y_l_avg"].fillna(0).values

C:\ProgramData\Anaconda3\python.exe C:/Users/Administrator/Documents/Projects/Quant/DM/ml_model.py
2013-01-01 2018-12-31
Time slice keys in hdf5: 2013/0101-0101,2014/0101-0101,2015/0101-0101,2016/0101-0101,2017/0101-0101,2018/0101-0101

Current key: 2013/0101-0101
Current slice size(length): 278061
Current subsample size(length): 27806

Current key: 2014/0101-0101
Current slice size(length): 291574
Current subsample size(length): 29157

Current key: 2015/0101-0101
Current slice size(length): 304680
Current subsample size(length): 30468

Current key: 2016/0101-0101
Current slice size(length): 313767
Current subsample size(length): 31376

Current key: 2017/0101-0101
Current slice size(length): 333371
Current subsample size(length): 33337

Current key: 2018/0101-0101
Current slice size(length): 347712
Current subsample size(length): 34771

Total concatenating size: 186915
Result dataset size: 186915
<class 'pandas.core.frame.DataFrame'>
Int64Index: 186915 entries, 20130402 to 20181130
Columns: 2037 entries, (10MA/20MA-1) to vol0
dtypes: float16(1987), float64(44), int64(1), uint8(5)
memory usage: 774.9 MB
None
(84, 8)
          y_l_rise  y_l_decline  y_l_avg  y_s_rise  y_s_decline  y_s_avg  y_l  \
date
20161205       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20160923       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161114       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161114       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161128       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161027       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161219       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161216       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161222       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161104       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161109       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161130       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161202       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170227       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170522       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171206       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171208       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171016       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170919       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171117       0.0          0.0      NaN       0.0          0.0      NaN  0.0

          y_l_r
date
20161205    0.0
20160923    0.0
20161114    0.0
20161114    0.0
20161128    0.0
20161027    0.0
20161219    0.0
20161216    0.0
20161222    0.0
20161104    0.0
20161109    0.0
20161130    0.0
20161202    0.0
20170227    0.0
20170522    0.0
20171206    0.0
20171208    0.0
20171016    0.0
20170919    0.0
20171117    0.0
(166089, 2036) (14831, 2036)
          y_l_rise  y_l_decline   y_l_avg  y_s_rise  y_s_decline   y_s_avg  \
date
20180702  0.047312    -0.163978 -0.068203  0.047312    -0.075806 -0.015995
20180702  0.165563    -0.033113  0.049453  0.039735    -0.033113 -0.000888
20180702  0.008969    -0.266816 -0.147618  0.008969    -0.118834 -0.045511
20180702  0.152809    -0.056180  0.055038  0.044944    -0.056180  0.004933
20180702  0.035185    -0.148148 -0.037396  0.016667    -0.148148 -0.061408
20180702  0.108163    -0.106122 -0.006134  0.028571    -0.093878 -0.016856
20180702  0.086592    -0.143855  0.004350  0.025140    -0.053073 -0.005898
20180702  0.106218    -0.077720  0.022556  0.039896    -0.077720 -0.016733
20180702  0.070423    -0.070423 -0.001644  0.009577    -0.070423 -0.022191
20180702  0.218097    -0.073086  0.043194  0.017401    -0.071926 -0.020303
20180702  0.058115    -0.055160  0.001152  0.005051    -0.050505 -0.015889
20180702  0.159667    -0.061807  0.052275  0.043978    -0.061807 -0.006260
20180702  0.140932    -0.052753  0.037754  0.062380    -0.038891  0.012364
20180702  0.065038    -0.120611 -0.018995  0.000000    -0.120611 -0.065893
20180702  0.012158    -0.144883 -0.067281  0.012158    -0.144883 -0.077498
20180702  0.184739    -0.013047  0.087529  0.080583    -0.013047  0.048225
20180702  0.116920    -0.068441  0.021932  0.024715    -0.068441  0.000435
20180702  0.087709    -0.161370 -0.013477  0.062248    -0.075680  0.004469
20180702  0.086323    -0.058296  0.009872  0.047085    -0.022422  0.009420
20180702  0.072833    -0.076923  0.013880  0.020000    -0.076923 -0.014639

               y_l     y_l_r
date
20180702 -0.163978 -0.140035
20180702  0.165563  0.136535
20180702 -0.266816 -0.237017
20180702  0.152809  0.128366
20180702 -0.148148 -0.120460
20180702  0.108163 -0.081125
20180702 -0.143855  0.066032
20180702  0.106218  0.085302
20180702 -0.070423 -0.053228
20180702  0.218097  0.174372
20180702  0.058115  0.043874
20180702  0.159667  0.132819
20180702  0.140932  0.115137
20180702 -0.120611 -0.095207
20180702 -0.144883 -0.125483
20180702  0.184739  0.160437
20180702  0.116920  0.093173
20180702 -0.161370 -0.124396
20180702  0.086323  0.067210
20180702 -0.076923  0.058094

--------------------Train network--------------------

 (166089, 2036) (166089,) {'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}, 'train_indexes': (0, None)}

----------Train layer 0----------
slice(0, None, None)

Train l2_y_l
C:\ProgramData\Anaconda3\lib\site-packages\lightgbm\basic.py:1042: UserWarning: categorical_feature in Dataset is overridden. New categorical_feature is ['area', 'exchange', 'is_hs', 'market']
  warnings.warn('categorical_feature in Dataset is overridden. New categorical_feature is {}'.format(sorted(list(categorical_feature))))
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 1016.50s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.1, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=50,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                      feature  importance_raw  \
2025                                   sz_vol              97
1865                                 sz50_vol              93
1705                                   sh_vol              87
567                                       amt              46
895                                 hs300_vol              42
1526          p80mv_(20k_low/p20mv_20k_low-1)              29
732                                   cyb_vol              25
1321          p40mv_(20k_avg/p20mv_20k_avg-1)              22
1449    p600mv_(120k_low-120k_close)/120k_avg              17
1466          p60mv_(20k_low/p20mv_20k_low-1)              16
1268             p360mv_lower_shadow/120k_avg              15
454                            (high-low)/avg              15
1457          p60mv_(20k_avg/p20mv_20k_avg-1)              15
568                                      area              13
1005  p1250mv_(250k_high-250k_close)/250k_avg              11
453                          (high-close)/avg              11
1061         p180mv_(60k_amt/p60mv_60k_amt-1)              11
2034                                      vol              11
1350             p480mv_lower_shadow/120k_avg              11
986       p120mv_(60k_close-60k_open)/60k_avg              10

      importance_percent
2025                6.47
1865                6.20
1705                5.80
567                 3.07
895                 2.80
1526                1.93
732                 1.67
1321                1.47
1449                1.13
1466                1.07
1268                1.00
454                 1.00
1457                1.00
568                 0.87
1005                0.73
453                 0.73
1061                0.73
2034                0.73
1350                0.73
986                 0.67
Among 2036 features, 1610 features are not used in the model

--------------------Predict--------------------

----------Layer 0 predicts----------

y_l_r
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     15     -0.124       -0.170     0.216     0.445    -0.442
(-0.05,0.00]    1449     -0.041       -0.065     0.132     0.809    -0.457
(0.00,0.05]    10226     -0.015       -0.044     0.126     0.913    -0.643
(0.05,0.10]     2366      0.013        0.039     0.153     1.065    -0.371
(0.10,0.15]      618      0.052        0.090     0.191     0.725    -0.308
(0.15,0.20]      135      0.069        0.115     0.213     0.789    -0.343
(0.20,0.25]       22      0.049        0.087     0.203     0.563    -0.245
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     15     -0.142       -0.195     0.246     0.510    -0.487
(-0.05,0.00]    1449     -0.054       -0.088     0.152     0.901    -0.496
(0.00,0.05]    10226     -0.023       -0.065     0.147     1.018    -0.677
(0.05,0.10]     2366      0.009       -0.051     0.179     1.211    -0.408
(0.10,0.15]      618      0.055        0.109     0.225     0.836    -0.346
(0.15,0.20]      135      0.071        0.131     0.252     0.890    -0.383
(0.20,0.25]       22      0.021        0.003     0.255     0.630    -0.310
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_avg
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     15     -0.068       -0.059     0.133     0.251    -0.309
(-0.05,0.00]    1449     -0.020       -0.013     0.073     0.532    -0.356
(0.00,0.05]    10226     -0.006       -0.006     0.066     0.596    -0.538
(0.05,0.10]     2366      0.010        0.002     0.081     0.648    -0.264
(0.10,0.15]      618      0.027        0.021     0.098     0.447    -0.236
(0.15,0.20]      135      0.033        0.031     0.112     0.487    -0.221
(0.20,0.25]       22      0.023        0.007     0.101     0.363    -0.171
(0.25,0.30]        0        NaN          NaN       NaN       NaN       NaN
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN




fit y_l 10-0

C:\ProgramData\Anaconda3\python.exe C:/Users/Administrator/Documents/Projects/Quant/DM/ml_model.py
2013-01-01 2018-12-31
Time slice keys in hdf5: 2013/0101-0101,2014/0101-0101,2015/0101-0101,2016/0101-0101,2017/0101-0101,2018/0101-0101

Current key: 2013/0101-0101
Current slice size(length): 278061
Current subsample size(length): 27806

Current key: 2014/0101-0101
Current slice size(length): 291574
Current subsample size(length): 29157

Current key: 2015/0101-0101
Current slice size(length): 304680
Current subsample size(length): 30468

Current key: 2016/0101-0101
Current slice size(length): 313767
Current subsample size(length): 31376

Current key: 2017/0101-0101
Current slice size(length): 333371
Current subsample size(length): 33337

Current key: 2018/0101-0101
Current slice size(length): 347712
Current subsample size(length): 34771

Total concatenating size: 186915
Result dataset size: 186915
<class 'pandas.core.frame.DataFrame'>
Int64Index: 186915 entries, 20130402 to 20181130
Columns: 2037 entries, (10MA/20MA-1) to vol0
dtypes: float16(1987), float64(44), int64(1), uint8(5)
memory usage: 774.9 MB
None
(84, 8)
          y_l_rise  y_l_decline  y_l_avg  y_s_rise  y_s_decline  y_s_avg  y_l  \
date
20161205       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20160923       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161114       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161114       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161128       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161027       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161219       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161216       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161222       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161104       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161109       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161130       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161202       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170227       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170522       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171206       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171208       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171016       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170919       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171117       0.0          0.0      NaN       0.0          0.0      NaN  0.0

          y_l_r
date
20161205    0.0
20160923    0.0
20161114    0.0
20161114    0.0
20161128    0.0
20161027    0.0
20161219    0.0
20161216    0.0
20161222    0.0
20161104    0.0
20161109    0.0
20161130    0.0
20161202    0.0
20170227    0.0
20170522    0.0
20171206    0.0
20171208    0.0
20171016    0.0
20170919    0.0
20171117    0.0
(166089, 2036) (14831, 2036)
          y_l_rise  y_l_decline   y_l_avg  y_s_rise  y_s_decline   y_s_avg  \
date
20180702  0.047312    -0.163978 -0.068203  0.047312    -0.075806 -0.015995
20180702  0.165563    -0.033113  0.049453  0.039735    -0.033113 -0.000888
20180702  0.008969    -0.266816 -0.147618  0.008969    -0.118834 -0.045511
20180702  0.152809    -0.056180  0.055038  0.044944    -0.056180  0.004933
20180702  0.035185    -0.148148 -0.037396  0.016667    -0.148148 -0.061408
20180702  0.108163    -0.106122 -0.006134  0.028571    -0.093878 -0.016856
20180702  0.086592    -0.143855  0.004350  0.025140    -0.053073 -0.005898
20180702  0.106218    -0.077720  0.022556  0.039896    -0.077720 -0.016733
20180702  0.070423    -0.070423 -0.001644  0.009577    -0.070423 -0.022191
20180702  0.218097    -0.073086  0.043194  0.017401    -0.071926 -0.020303
20180702  0.058115    -0.055160  0.001152  0.005051    -0.050505 -0.015889
20180702  0.159667    -0.061807  0.052275  0.043978    -0.061807 -0.006260
20180702  0.140932    -0.052753  0.037754  0.062380    -0.038891  0.012364
20180702  0.065038    -0.120611 -0.018995  0.000000    -0.120611 -0.065893
20180702  0.012158    -0.144883 -0.067281  0.012158    -0.144883 -0.077498
20180702  0.184739    -0.013047  0.087529  0.080583    -0.013047  0.048225
20180702  0.116920    -0.068441  0.021932  0.024715    -0.068441  0.000435
20180702  0.087709    -0.161370 -0.013477  0.062248    -0.075680  0.004469
20180702  0.086323    -0.058296  0.009872  0.047085    -0.022422  0.009420
20180702  0.072833    -0.076923  0.013880  0.020000    -0.076923 -0.014639

               y_l     y_l_r
date
20180702 -0.163978 -0.140035
20180702  0.165563  0.136535
20180702 -0.266816 -0.237017
20180702  0.152809  0.128366
20180702 -0.148148 -0.120460
20180702  0.108163 -0.081125
20180702 -0.143855  0.066032
20180702  0.106218  0.085302
20180702 -0.070423 -0.053228
20180702  0.218097  0.174372
20180702  0.058115  0.043874
20180702  0.159667  0.132819
20180702  0.140932  0.115137
20180702 -0.120611 -0.095207
20180702 -0.144883 -0.125483
20180702  0.184739  0.160437
20180702  0.116920  0.093173
20180702 -0.161370 -0.124396
20180702  0.086323  0.067210
20180702 -0.076923  0.058094

--------------------Train network--------------------

 (166089, 2036) (166089,) {'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}, 'train_indexes': (0, None)}

----------Train layer 0----------
slice(0, None, None)

Train l2_y_l
C:\ProgramData\Anaconda3\lib\site-packages\lightgbm\basic.py:1042: UserWarning: categorical_feature in Dataset is overridden. New categorical_feature is ['area', 'exchange', 'is_hs', 'market']
  warnings.warn('categorical_feature in Dataset is overridden. New categorical_feature is {}'.format(sorted(list(categorical_feature))))
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 863.20s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.1, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=50,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                    feature  importance_raw  \
2025                                 sz_vol              95
1705                                 sh_vol              90
1865                               sz50_vol              81
567                                     amt              42
1526        p80mv_(20k_low/p20mv_20k_low-1)              32
895                               hs300_vol              31
1466        p60mv_(20k_low/p20mv_20k_low-1)              23
1457        p60mv_(20k_avg/p20mv_20k_avg-1)              23
732                                 cyb_vol              23
454                          (high-low)/avg              18
1449  p600mv_(120k_low-120k_close)/120k_avg              16
1321        p40mv_(20k_avg/p20mv_20k_avg-1)              16
1350           p480mv_lower_shadow/120k_avg              14
937      p100mv_(20k_open/p20mv_20k_open-1)              13
1061       p180mv_(60k_amt/p60mv_60k_amt-1)              12
1120       p20mv_(20k_low-20k_open)/20k_avg              12
1346   p480mv_(120k_low-120k_open)/120k_avg              11
453                        (high-close)/avg              11
1268           p360mv_lower_shadow/120k_avg              11
986     p120mv_(60k_close-60k_open)/60k_avg              11

      importance_percent
2025                6.33
1705                6.00
1865                5.40
567                 2.80
1526                2.13
895                 2.07
1466                1.53
1457                1.53
732                 1.53
454                 1.20
1449                1.07
1321                1.07
1350                0.93
937                 0.87
1061                0.80
1120                0.80
1346                0.73
453                 0.73
1268                0.73
986                 0.73
Among 2036 features, 1593 features are not used in the model

--------------------Predict--------------------

----------Layer 0 predicts----------

y_l_r
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     81     -0.048       -0.087     0.138     0.445    -0.289
(-0.05,0.00]    2163     -0.045       -0.074     0.130     0.809    -0.643
(0.00,0.05]     9147     -0.012       -0.040     0.126     0.913    -0.564
(0.05,0.10]     2484      0.010        0.033     0.150     1.065    -0.399
(0.10,0.15]      649      0.041        0.083     0.181     0.629    -0.348
(0.15,0.20]      271      0.046        0.084     0.204     0.639    -0.343
(0.20,0.25]       34      0.070        0.071     0.244     0.789    -0.308
(0.25,0.30]        2     -0.019       -0.019     0.321     0.208    -0.245
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     81     -0.062       -0.111     0.158     0.510    -0.333
(-0.05,0.00]    2163     -0.058       -0.094     0.150     0.901    -0.677
(0.00,0.05]     9147     -0.020       -0.061     0.147     1.018    -0.607
(0.05,0.10]     2484      0.007       -0.049     0.176     1.211    -0.440
(0.10,0.15]      649      0.041        0.100     0.213     0.707    -0.388
(0.15,0.20]      271      0.045        0.101     0.242     0.710    -0.383
(0.20,0.25]       34      0.052        0.003     0.293     0.890    -0.332
(0.25,0.30]        2     -0.011       -0.011     0.366     0.248    -0.270
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_avg
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     81     -0.026       -0.018     0.075     0.251    -0.166
(-0.05,0.00]    2163     -0.022       -0.018     0.071     0.532    -0.538
(0.00,0.05]     9147     -0.004       -0.004     0.066     0.596    -0.495
(0.05,0.10]     2484      0.009        0.001     0.079     0.648    -0.276
(0.10,0.15]      649      0.022        0.015     0.093     0.397    -0.248
(0.15,0.20]      271      0.026        0.016     0.105     0.447    -0.221
(0.20,0.25]       34      0.037        0.008     0.138     0.487    -0.236
(0.25,0.30]        2     -0.042       -0.042     0.183     0.088    -0.171
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_rise
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     81      0.061        0.032     0.080     0.510     0.000
(-0.05,0.00]    2163      0.060        0.038     0.072     0.901     0.000
(0.00,0.05]     9147      0.074        0.054     0.072     1.018     0.000
(0.05,0.10]     2484      0.102        0.078     0.096     1.211     0.000
(0.10,0.15]      649      0.140        0.110     0.118     0.707     0.000
(0.15,0.20]      271      0.158        0.116     0.139     0.710     0.000
(0.20,0.25]       34      0.180        0.118     0.200     0.890     0.000
(0.25,0.30]        2      0.128        0.128     0.170     0.248     0.008
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN






cond= Y.notnull().all(axis=1)
fit y_l 10-0
C:\ProgramData\Anaconda3\python.exe C:/Users/Administrator/Documents/Projects/Quant/DM/ml_model.py
2013-01-01 2018-12-31
Time slice keys in hdf5: 2013/0101-0101,2014/0101-0101,2015/0101-0101,2016/0101-0101,2017/0101-0101,2018/0101-0101

Current key: 2013/0101-0101
Current slice size(length): 278061
Current subsample size(length): 5561

Current key: 2014/0101-0101
Current slice size(length): 291574
Current subsample size(length): 5831

Current key: 2015/0101-0101
Current slice size(length): 304680
Current subsample size(length): 6093

Current key: 2016/0101-0101
Current slice size(length): 313767
Current subsample size(length): 6275

Current key: 2017/0101-0101
Current slice size(length): 333371
Current subsample size(length): 6667

Current key: 2018/0101-0101
Current slice size(length): 347712
Current subsample size(length): 6954

Total concatenating size: 37381
Result dataset size: 37381
<class 'pandas.core.frame.DataFrame'>
Int64Index: 37381 entries, 20130402 to 20181130
Columns: 2037 entries, (10MA/20MA-1) to vol0
dtypes: float16(1987), float64(44), int64(1), uint8(5)
memory usage: 155.0 MB
None
(16, 8)
          y_l_rise  y_l_decline  y_l_avg  y_s_rise  y_s_decline  y_s_avg  y_l  \
date
20161205       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161128       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161216       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170522       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170703       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170925       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171123       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171106       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170915       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171009       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20180119       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20181120       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20181213       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20180918       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20180404       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20181226       0.0          0.0      NaN       0.0          0.0      NaN  0.0

          y_l_r
date
20161205    0.0
20161128    0.0
20161216    0.0
20170522    0.0
20170703    0.0
20170925    0.0
20171123    0.0
20171106    0.0
20170915    0.0
20171009    0.0
20180119    0.0
20181120    0.0
20181213    0.0
20180918    0.0
20180404    0.0
20181226    0.0
(33228, 2036) (2959, 2036)
          y_l_rise  y_l_decline   y_l_avg  y_s_rise  y_s_decline   y_s_avg  \
date
20180702  0.047312    -0.163978 -0.068203  0.047312    -0.075806 -0.015995
20180702  0.165563    -0.033113  0.049453  0.039735    -0.033113 -0.000888
20180702  0.008969    -0.266816 -0.147618  0.008969    -0.118834 -0.045511
20180702  0.152809    -0.056180  0.055038  0.044944    -0.056180  0.004933
20180702  0.035185    -0.148148 -0.037396  0.016667    -0.148148 -0.061408
20180702  0.108163    -0.106122 -0.006134  0.028571    -0.093878 -0.016856
20180702  0.086592    -0.143855  0.004350  0.025140    -0.053073 -0.005898
20180702  0.106218    -0.077720  0.022556  0.039896    -0.077720 -0.016733
20180702  0.070423    -0.070423 -0.001644  0.009577    -0.070423 -0.022191
20180702  0.218097    -0.073086  0.043194  0.017401    -0.071926 -0.020303
20180702  0.058115    -0.055160  0.001152  0.005051    -0.050505 -0.015889
20180702  0.159667    -0.061807  0.052275  0.043978    -0.061807 -0.006260
20180702  0.140932    -0.052753  0.037754  0.062380    -0.038891  0.012364
20180702  0.065038    -0.120611 -0.018995  0.000000    -0.120611 -0.065893
20180702  0.012158    -0.144883 -0.067281  0.012158    -0.144883 -0.077498
20180702  0.184739    -0.013047  0.087529  0.080583    -0.013047  0.048225
20180702  0.116920    -0.068441  0.021932  0.024715    -0.068441  0.000435
20180702  0.087709    -0.161370 -0.013477  0.062248    -0.075680  0.004469
20180702  0.086323    -0.058296  0.009872  0.047085    -0.022422  0.009420
20180702  0.072833    -0.076923  0.013880  0.020000    -0.076923 -0.014639

               y_l     y_l_r
date
20180702 -0.163978 -0.140035
20180702  0.165563  0.136535
20180702 -0.266816 -0.237017
20180702  0.152809  0.128366
20180702 -0.148148 -0.120460
20180702  0.108163 -0.081125
20180702 -0.143855  0.066032
20180702  0.106218  0.085302
20180702 -0.070423 -0.053228
20180702  0.218097  0.174372
20180702  0.058115  0.043874
20180702  0.159667  0.132819
20180702  0.140932  0.115137
20180702 -0.120611 -0.095207
20180702 -0.144883 -0.125483
20180702  0.184739  0.160437
20180702  0.116920  0.093173
20180702 -0.161370 -0.124396
20180702  0.086323  0.067210
20180702 -0.076923  0.058094

--------------------Train network--------------------

 (33228, 2036) (33228,) {'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}, 'train_indexes': (0, None)}

----------Train layer 0----------
slice(0, None, None)

Train l2_y_l
C:\ProgramData\Anaconda3\lib\site-packages\lightgbm\basic.py:1042: UserWarning: categorical_feature in Dataset is overridden. New categorical_feature is ['area', 'exchange', 'is_hs', 'market']
  warnings.warn('categorical_feature in Dataset is overridden. New categorical_feature is {}'.format(sorted(list(categorical_feature))))
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 39.17s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.1, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=50,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                    feature  importance_raw  \
1865                               sz50_vol              53
1705                                 sh_vol              43
2025                                 sz_vol              39
567                                     amt              30
1526        p80mv_(20k_low/p20mv_20k_low-1)              20
568                                    area              18
895                               hs300_vol              15
1449  p600mv_(120k_low-120k_close)/120k_avg              13
1061       p180mv_(60k_amt/p60mv_60k_amt-1)              13
986     p120mv_(60k_close-60k_open)/60k_avg              12
937      p100mv_(20k_open/p20mv_20k_open-1)              12
1457        p60mv_(20k_avg/p20mv_20k_avg-1)              12
1350           p480mv_lower_shadow/120k_avg              11
1466        p60mv_(20k_low/p20mv_20k_low-1)              11
1138             p20mv_lower_shadow/20k_avg              10
1346   p480mv_(120k_low-120k_open)/120k_avg              10
732                                 cyb_vol              10
1268           p360mv_lower_shadow/120k_avg              10
1525       p80mv_(20k_low-20k_open)/20k_avg              10
234                 (3k_high-3k_low)/3k_avg               9

      importance_percent
1865                3.53
1705                2.87
2025                2.60
567                 2.00
1526                1.33
568                 1.20
895                 1.00
1449                0.87
1061                0.87
986                 0.80
937                 0.80
1457                0.80
1350                0.73
1466                0.73
1138                0.67
1346                0.67
732                 0.67
1268                0.67
1525                0.67
234                 0.60
Among 2036 features, 1444 features are not used in the model

--------------------Predict--------------------

----------Layer 0 predicts----------

y_l_r
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     20     -0.038       -0.034     0.140     0.207    -0.207
(-0.05,0.00]     365     -0.057       -0.093     0.142     0.809    -0.643
(0.00,0.05]     1763     -0.013       -0.040     0.126     0.746    -0.561
(0.05,0.10]      612      0.009        0.040     0.146     0.752    -0.304
(0.10,0.15]      115      0.036        0.085     0.165     0.464    -0.308
(0.15,0.20]       66      0.077        0.098     0.224     0.617    -0.288
(0.20,0.25]       15      0.108        0.146     0.196     0.418    -0.245
(0.25,0.30]        2      0.224        0.224     0.002     0.226     0.223
(0.30,0.35]        1      0.208        0.208       NaN     0.208     0.208
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     20     -0.056       -0.110     0.160     0.245    -0.242
(-0.05,0.00]     365     -0.069       -0.115     0.163     0.901    -0.677
(0.00,0.05]     1763     -0.020       -0.063     0.146     0.810    -0.599
(0.05,0.10]      612      0.005       -0.043     0.171     0.830    -0.348
(0.10,0.15]      115      0.038        0.101     0.194     0.518    -0.351
(0.15,0.20]       66      0.074        0.123     0.266     0.696    -0.341
(0.20,0.25]       15      0.124        0.192     0.236     0.474    -0.270
(0.25,0.30]        2      0.248        0.248     0.002     0.250     0.247
(0.30,0.35]        1      0.248        0.248       NaN     0.248     0.248
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_avg
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     20     -0.021       -0.004     0.073     0.107    -0.117
(-0.05,0.00]     365     -0.027       -0.028     0.083     0.532    -0.538
(0.00,0.05]     1763     -0.006       -0.004     0.067     0.556    -0.446
(0.05,0.10]      612      0.007        0.003     0.077     0.515    -0.229
(0.10,0.15]      115      0.019        0.024     0.087     0.304    -0.236
(0.15,0.20]       66      0.039        0.014     0.122     0.383    -0.182
(0.20,0.25]       15      0.048        0.061     0.104     0.247    -0.171
(0.25,0.30]        2      0.152        0.152     0.016     0.164     0.140
(0.30,0.35]        1      0.088        0.088       NaN     0.088     0.088
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_rise
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     20      0.064        0.044     0.072     0.245     0.000
(-0.05,0.00]     365      0.063        0.039     0.083     0.901     0.000
(0.00,0.05]     1763      0.073        0.054     0.072     0.810     0.000
(0.05,0.10]      612      0.098        0.078     0.091     0.830     0.000
(0.10,0.15]      115      0.128        0.109     0.097     0.518     0.000
(0.15,0.20]       66      0.179        0.123     0.168     0.696     0.000
(0.20,0.25]       15      0.208        0.192     0.115     0.474     0.008
(0.25,0.30]        2      0.248        0.248     0.002     0.250     0.247
(0.30,0.35]        1      0.248        0.248       NaN     0.248     0.248
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN











cond= Y.notnull().all(axis=1)
fit y_l_r 10-0
C:\ProgramData\Anaconda3\python.exe C:/Users/Administrator/Documents/Projects/Quant/DM/ml_model.py
2013-01-01 2018-12-31
Time slice keys in hdf5: 2013/0101-0101,2014/0101-0101,2015/0101-0101,2016/0101-0101,2017/0101-0101,2018/0101-0101

Current key: 2013/0101-0101
Current slice size(length): 278061
Current subsample size(length): 5561

Current key: 2014/0101-0101
Current slice size(length): 291574
Current subsample size(length): 5831

Current key: 2015/0101-0101
Current slice size(length): 304680
Current subsample size(length): 6093

Current key: 2016/0101-0101
Current slice size(length): 313767
Current subsample size(length): 6275

Current key: 2017/0101-0101
Current slice size(length): 333371
Current subsample size(length): 6667

Current key: 2018/0101-0101
Current slice size(length): 347712
Current subsample size(length): 6954

Total concatenating size: 37381
Result dataset size: 37381
<class 'pandas.core.frame.DataFrame'>
Int64Index: 37381 entries, 20130402 to 20181130
Columns: 2037 entries, (10MA/20MA-1) to vol0
dtypes: float16(1987), float64(44), int64(1), uint8(5)
memory usage: 155.0 MB
None
(16, 8)
          y_l_rise  y_l_decline  y_l_avg  y_s_rise  y_s_decline  y_s_avg  y_l  \
date
20161205       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161128       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161216       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170522       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170703       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170925       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171123       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171106       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170915       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20171009       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20180119       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20181120       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20181213       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20180918       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20180404       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20181226       0.0          0.0      NaN       0.0          0.0      NaN  0.0

          y_l_r
date
20161205    0.0
20161128    0.0
20161216    0.0
20170522    0.0
20170703    0.0
20170925    0.0
20171123    0.0
20171106    0.0
20170915    0.0
20171009    0.0
20180119    0.0
20181120    0.0
20181213    0.0
20180918    0.0
20180404    0.0
20181226    0.0
(33228, 2036) (2959, 2036)
          y_l_rise  y_l_decline   y_l_avg  y_s_rise  y_s_decline   y_s_avg  \
date
20180702  0.047312    -0.163978 -0.068203  0.047312    -0.075806 -0.015995
20180702  0.165563    -0.033113  0.049453  0.039735    -0.033113 -0.000888
20180702  0.008969    -0.266816 -0.147618  0.008969    -0.118834 -0.045511
20180702  0.152809    -0.056180  0.055038  0.044944    -0.056180  0.004933
20180702  0.035185    -0.148148 -0.037396  0.016667    -0.148148 -0.061408
20180702  0.108163    -0.106122 -0.006134  0.028571    -0.093878 -0.016856
20180702  0.086592    -0.143855  0.004350  0.025140    -0.053073 -0.005898
20180702  0.106218    -0.077720  0.022556  0.039896    -0.077720 -0.016733
20180702  0.070423    -0.070423 -0.001644  0.009577    -0.070423 -0.022191
20180702  0.218097    -0.073086  0.043194  0.017401    -0.071926 -0.020303
20180702  0.058115    -0.055160  0.001152  0.005051    -0.050505 -0.015889
20180702  0.159667    -0.061807  0.052275  0.043978    -0.061807 -0.006260
20180702  0.140932    -0.052753  0.037754  0.062380    -0.038891  0.012364
20180702  0.065038    -0.120611 -0.018995  0.000000    -0.120611 -0.065893
20180702  0.012158    -0.144883 -0.067281  0.012158    -0.144883 -0.077498
20180702  0.184739    -0.013047  0.087529  0.080583    -0.013047  0.048225
20180702  0.116920    -0.068441  0.021932  0.024715    -0.068441  0.000435
20180702  0.087709    -0.161370 -0.013477  0.062248    -0.075680  0.004469
20180702  0.086323    -0.058296  0.009872  0.047085    -0.022422  0.009420
20180702  0.072833    -0.076923  0.013880  0.020000    -0.076923 -0.014639

               y_l     y_l_r
date
20180702 -0.163978 -0.140035
20180702  0.165563  0.136535
20180702 -0.266816 -0.237017
20180702  0.152809  0.128366
20180702 -0.148148 -0.120460
20180702  0.108163 -0.081125
20180702 -0.143855  0.066032
20180702  0.106218  0.085302
20180702 -0.070423 -0.053228
20180702  0.218097  0.174372
20180702  0.058115  0.043874
20180702  0.159667  0.132819
20180702  0.140932  0.115137
20180702 -0.120611 -0.095207
20180702 -0.144883 -0.125483
20180702  0.184739  0.160437
20180702  0.116920  0.093173
20180702 -0.161370 -0.124396
20180702  0.086323  0.067210
20180702 -0.076923  0.058094

--------------------Train network--------------------

 (33228, 2036) (33228,) {'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}, 'train_indexes': (0, None)}

----------Train layer 0----------
slice(0, None, None)

Train l2_y_l
C:\ProgramData\Anaconda3\lib\site-packages\lightgbm\basic.py:1042: UserWarning: categorical_feature in Dataset is overridden. New categorical_feature is ['area', 'exchange', 'is_hs', 'market']
  warnings.warn('categorical_feature in Dataset is overridden. New categorical_feature is {}'.format(sorted(list(categorical_feature))))
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 37.15s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.1, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=50,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                    feature  importance_raw  \
1865                               sz50_vol              52
1705                                 sh_vol              46
2025                                 sz_vol              42
567                                     amt              24
1526        p80mv_(20k_low/p20mv_20k_low-1)              20
895                               hs300_vol              17
568                                    area              16
1466        p60mv_(20k_low/p20mv_20k_low-1)              15
1268           p360mv_lower_shadow/120k_avg              14
986     p120mv_(60k_close-60k_open)/60k_avg              14
732                                 cyb_vol              14
1350           p480mv_lower_shadow/120k_avg              13
1061       p180mv_(60k_amt/p60mv_60k_amt-1)              12
1346   p480mv_(120k_low-120k_open)/120k_avg              12
1449  p600mv_(120k_low-120k_close)/120k_avg              12
937      p100mv_(20k_open/p20mv_20k_open-1)              11
1457        p60mv_(20k_avg/p20mv_20k_avg-1)              10
2034                                    vol              10
939             p100mv_lower_shadow/20k_avg              10
1450   p600mv_(120k_low-120k_open)/120k_avg              10

      importance_percent
1865                3.47
1705                3.07
2025                2.80
567                 1.60
1526                1.33
895                 1.13
568                 1.07
1466                1.00
1268                0.93
986                 0.93
732                 0.93
1350                0.87
1061                0.80
1346                0.80
1449                0.80
937                 0.73
1457                0.67
2034                0.67
939                 0.67
1450                0.67
Among 2036 features, 1438 features are not used in the model

--------------------Predict--------------------

----------Layer 0 predicts----------

y_l_r
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]      5     -0.141       -0.178     0.088     0.000    -0.224
(-0.05,0.00]     228     -0.064       -0.095     0.137     0.316    -0.643
(0.00,0.05]     1967     -0.014       -0.041     0.128     0.809    -0.561
(0.05,0.10]      596      0.010        0.039     0.149     0.746    -0.304
(0.10,0.15]      123      0.048        0.083     0.194     0.617    -0.308
(0.15,0.20]       32      0.095        0.133     0.206     0.563    -0.245
(0.20,0.25]        7      0.090        0.146     0.155     0.226    -0.143
(0.25,0.30]        1      0.208        0.208       NaN     0.208     0.208
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]      5     -0.159       -0.198     0.099     0.000    -0.250
(-0.05,0.00]     228     -0.077       -0.116     0.156     0.351    -0.677
(0.00,0.05]     1967     -0.021       -0.063     0.149     0.901    -0.599
(0.05,0.10]      596      0.006       -0.055     0.175     0.810    -0.351
(0.10,0.15]      123      0.051        0.103     0.227     0.696    -0.332
(0.15,0.20]       32      0.092        0.169     0.249     0.630    -0.270
(0.20,0.25]        7      0.041        0.088     0.220     0.252    -0.250
(0.25,0.30]        1      0.248        0.248       NaN     0.248     0.248
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_avg
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]      5     -0.085       -0.110     0.057     0.000    -0.144
(-0.05,0.00]     228     -0.031       -0.027     0.082     0.214    -0.538
(0.00,0.05]     1967     -0.007       -0.005     0.068     0.532    -0.446
(0.05,0.10]      596      0.009        0.002     0.080     0.556    -0.229
(0.10,0.15]      123      0.024        0.014     0.104     0.383    -0.236
(0.15,0.20]       32      0.044        0.047     0.113     0.363    -0.171
(0.20,0.25]        7      0.054        0.044     0.081     0.164    -0.059
(0.25,0.30]        1      0.088        0.088       NaN     0.088     0.088
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_rise
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]      5      0.012        0.008     0.014     0.034     0.000
(-0.05,0.00]     228      0.057        0.031     0.069     0.351     0.000
(0.00,0.05]     1967      0.073        0.054     0.074     0.901     0.000
(0.05,0.10]      596      0.101        0.081     0.095     0.810     0.000
(0.10,0.15]      123      0.148        0.110     0.136     0.696     0.000
(0.15,0.20]       32      0.183        0.169     0.153     0.630     0.008
(0.20,0.25]        7      0.166        0.179     0.086     0.252     0.057
(0.25,0.30]        1      0.248        0.248       NaN     0.248     0.248
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

















fit y_l_r 10-0
C:\Users\dell-pc\Anaconda3.6\python.exe C:/Users/dell-pc/Quant/Quant/ml_model.py
2013-01-01 2018-12-31
Time slice keys in hdf5: 2013/0101-0101,2014/0101-0101,2015/0101-0101,2016/0101-0101,2017/0101-0101,2018/0101-0101

Current key: 2013/0101-0101
Current slice size(length): 278061
Current subsample size(length): 27806

Current key: 2014/0101-0101
Current slice size(length): 291574
Current subsample size(length): 29157

Current key: 2015/0101-0101
Current slice size(length): 304680
Current subsample size(length): 30468

Current key: 2016/0101-0101
Current slice size(length): 313767
Current subsample size(length): 31376

Current key: 2017/0101-0101
Current slice size(length): 333371
Current subsample size(length): 33337

Current key: 2018/0101-0101
Current slice size(length): 347712
Current subsample size(length): 34771

Total concatenating size: 186915
Result dataset size: 186915
<class 'pandas.core.frame.DataFrame'>
Int64Index: 186915 entries, 20130607 to 20180925
Columns: 2037 entries, (10MA/20MA-1) to vol0
dtypes: float16(1987), float64(44), int64(1), uint8(5)
memory usage: 774.9 MB
None
(95, 8)
          y_l_rise  y_l_decline  y_l_avg  y_s_rise  y_s_decline  y_s_avg  y_l  \
date
20161202       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161216       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161208       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161205       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161025       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161026       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161010       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161027       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161117       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161102       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20160927       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161214       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161014       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161226       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161020       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170324       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170707       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170926       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170926       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170405       0.0          0.0      NaN       0.0          0.0      NaN  0.0

          y_l_r
date
20161202    0.0
20161216    0.0
20161208    0.0
20161205    0.0
20161025    0.0
20161026    0.0
20161010    0.0
20161027    0.0
20161117    0.0
20161102    0.0
20160927    0.0
20161214    0.0
20161014    0.0
20161226    0.0
20161020    0.0
20170324    0.0
20170707    0.0
20170926    0.0
20170926    0.0
20170405    0.0
(166068, 2036) (14786, 2036)
          y_l_rise  y_l_decline   y_l_avg  y_s_rise  y_s_decline   y_s_avg  \
date
20180702  0.131731    -0.113462  0.010095  0.048077    -0.113462 -0.028717
20180702  0.094720    -0.064056  0.031932  0.075637    -0.064056  0.010495
20180702  0.047527    -0.081567 -0.012935  0.000642    -0.081567 -0.040401
20180702  0.083636    -0.029091  0.016892  0.036364    -0.018182  0.009272
20180702  0.173484    -0.089366  0.060259  0.000000    -0.089366 -0.037225
20180702  0.086037    -0.049365  0.029736  0.032440    -0.049365 -0.004042
20180702  0.099291    -0.007092  0.053465  0.037825    -0.007092  0.017350
20180702  0.196126    -0.041162  0.054833  0.036320    -0.041162  0.002209
20180702  0.161572    -0.049491  0.098269  0.072780    -0.049491  0.018849
20180702  0.112392    -0.046110  0.040382  0.020173    -0.031700  0.001200
20180702  0.026711    -0.235392 -0.135519  0.026711    -0.063439 -0.013439
20180702  0.070423    -0.070423 -0.001644  0.009577    -0.070423 -0.022191
20180702  0.212513    -0.038617  0.088093  0.064730    -0.038617  0.020130
20180702  0.190231     0.000000  0.108106  0.089974     0.000000  0.050105
20180702  0.037143    -0.110000 -0.047763  0.037143    -0.064286 -0.007056
20180702  0.040896    -0.127556 -0.054137  0.034080    -0.042843  0.001272
20180702  0.105212    -0.012917  0.046348  0.036598    -0.012917  0.008469
20180702  0.053135    -0.051635  0.009424  0.005164    -0.051635 -0.013805
20180702  0.033344    -0.116543 -0.030064  0.033344    -0.057948 -0.006487
20180702  0.327982    -0.021407  0.202673  0.093272    -0.021407  0.023226

               y_l     y_l_r
date
20180702  0.131731  0.101322
20180702  0.094720  0.079023
20180702 -0.081567 -0.064409
20180702  0.083636  0.066950
20180702  0.173484  0.145177
20180702  0.086037  0.071961
20180702  0.099291  0.087834
20180702  0.196126  0.160803
20180702  0.161572  0.145746
20180702  0.112392  0.094389
20180702 -0.235392 -0.210424
20180702 -0.070423 -0.053228
20180702  0.212513  0.181408
20180702  0.190231  0.169700
20180702 -0.110000 -0.094441
20180702 -0.127556 -0.109201
20180702  0.105212  0.090496
20180702  0.053135  0.042207
20180702 -0.116543 -0.094923
20180702  0.327982  0.296654

--------------------Train network--------------------

 (166068, 2036) (166068,) {'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}, 'train_indexes': (0, None)}

----------Train layer 0----------
slice(0, None, None)

Train l2_y_l
C:\Users\dell-pc\Anaconda3.6\lib\site-packages\lightgbm\basic.py:1042: UserWarning: categorical_feature in Dataset is overridden. New categorical_feature is ['area', 'exchange', 'is_hs', 'market']
  warnings.warn('categorical_feature in Dataset is overridden. New categorical_feature is {}'.format(sorted(list(categorical_feature))))
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 128.11s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.1, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=50,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                    feature  importance_raw  \
2025                                 sz_vol             100
1705                                 sh_vol              93
1865                               sz50_vol              78
895                               hs300_vol              55
567                                     amt              41
1526        p80mv_(20k_low/p20mv_20k_low-1)              27
732                                 cyb_vol              23
1466        p60mv_(20k_low/p20mv_20k_low-1)              22
454                          (high-low)/avg              17
937      p100mv_(20k_open/p20mv_20k_open-1)              14
1268           p360mv_lower_shadow/120k_avg              13
1449  p600mv_(120k_low-120k_close)/120k_avg              12
986     p120mv_(60k_close-60k_open)/60k_avg              12
1120       p20mv_(20k_low-20k_open)/20k_avg              12
1350           p480mv_lower_shadow/120k_avg              12
1138             p20mv_lower_shadow/20k_avg              12
141             (20k_high/p80mv_20k_high-1)              11
2035                                   vol0              11
1321        p40mv_(20k_avg/p20mv_20k_avg-1)              11
1351           p480mv_upper_shadow/120k_avg              10

      importance_percent
2025                6.67
1705                6.20
1865                5.20
895                 3.67
567                 2.73
1526                1.80
732                 1.53
1466                1.47
454                 1.13
937                 0.93
1268                0.87
1449                0.80
986                 0.80
1120                0.80
1350                0.80
1138                0.80
141                 0.73
2035                0.73
1321                0.73
1351                0.67
Among 2036 features, 1589 features are not used in the model

--------------------Predict--------------------

----------Layer 0 predicts----------

y_l_r
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     11     -0.015        0.000     0.172     0.384    -0.188
(-0.05,0.00]    1433     -0.051       -0.072     0.121     0.888    -0.484
(0.00,0.05]    10025     -0.017       -0.045     0.126     0.924    -0.635
(0.05,0.10]     2457      0.016        0.054     0.150     0.791    -0.417
(0.10,0.15]      685      0.054        0.089     0.187     0.776    -0.419
(0.15,0.20]      154      0.063        0.117     0.192     0.585    -0.305
(0.20,0.25]       19      0.087        0.136     0.195     0.420    -0.275
(0.25,0.30]        2      0.016        0.016     0.309     0.234    -0.203
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     11     -0.019        0.000     0.200     0.438    -0.231
(-0.05,0.00]    1433     -0.064       -0.091     0.139     0.983    -0.562
(0.00,0.05]    10025     -0.027       -0.066     0.147     1.012    -0.659
(0.05,0.10]     2457      0.012        0.045     0.177     0.852    -0.467
(0.10,0.15]      685      0.054        0.105     0.223     0.872    -0.466
(0.15,0.20]      154      0.067        0.146     0.229     0.695    -0.361
(0.20,0.25]       19      0.100        0.164     0.230     0.471    -0.339
(0.25,0.30]        2      0.004        0.004     0.371     0.266    -0.259
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_avg
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     11     -0.003        0.000     0.091     0.223    -0.112
(-0.05,0.00]    1433     -0.025       -0.019     0.067     0.602    -0.386
(0.00,0.05]    10025     -0.007       -0.006     0.066     0.660    -0.564
(0.05,0.10]     2457      0.012        0.007     0.077     0.608    -0.289
(0.10,0.15]      685      0.028        0.020     0.096     0.486    -0.278
(0.15,0.20]      154      0.030        0.025     0.095     0.384    -0.202
(0.20,0.25]       19      0.057        0.052     0.097     0.269    -0.173
(0.25,0.30]        2      0.052        0.052     0.122     0.138    -0.035
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_rise
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     11      0.082        0.047     0.128     0.438     0.000
(-0.05,0.00]    1433      0.054        0.035     0.065     0.983     0.000
(0.00,0.05]    10025      0.071        0.052     0.072     1.012     0.000
(0.05,0.10]     2457      0.108        0.089     0.090     0.852     0.000
(0.10,0.15]      685      0.151        0.116     0.129     0.872     0.000
(0.15,0.20]      154      0.167        0.149     0.127     0.695     0.000
(0.20,0.25]       19      0.190        0.170     0.109     0.471     0.035
(0.25,0.30]        2      0.180        0.180     0.122     0.266     0.093
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN
















fit y_l_r 5-0
C:\Users\dell-pc\Anaconda3.6\python.exe C:/Users/dell-pc/Quant/Quant/ml_model.py
2013-01-01 2018-12-31
Time slice keys in hdf5: 2013/0101-0101,2014/0101-0101,2015/0101-0101,2016/0101-0101,2017/0101-0101,2018/0101-0101

Current key: 2013/0101-0101
Current slice size(length): 278061
Current subsample size(length): 55612

Current key: 2014/0101-0101
Current slice size(length): 291574
Current subsample size(length): 58314

Current key: 2015/0101-0101
Current slice size(length): 304680
Current subsample size(length): 60936

Current key: 2016/0101-0101
Current slice size(length): 313767
Current subsample size(length): 62753

Current key: 2017/0101-0101
Current slice size(length): 333371
Current subsample size(length): 66674

Current key: 2018/0101-0101
Current slice size(length): 347712
Current subsample size(length): 69542

Total concatenating size: 373831
Result dataset size: 373831
<class 'pandas.core.frame.DataFrame'>
Int64Index: 373831 entries, 20130607 to 20180925
Columns: 2037 entries, (10MA/20MA-1) to vol0
dtypes: float16(1987), float64(44), int64(1), uint8(5)
memory usage: 1.5 GB
None
(185, 8)
          y_l_rise  y_l_decline  y_l_avg  y_s_rise  y_s_decline  y_s_avg  y_l  \
date
20161202       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161216       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161121       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161208       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161205       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161025       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161103       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161111       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161026       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161108       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161125       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161010       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161027       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161128       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161117       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161102       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161102       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20160927       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161214       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20160926       0.0          0.0      NaN       0.0          0.0      NaN  0.0

          y_l_r
date
20161202    NaN
20161216    NaN
20161121    NaN
20161208    NaN
20161205    NaN
20161025    NaN
20161103    NaN
20161111    NaN
20161026    NaN
20161108    NaN
20161125    NaN
20161010    NaN
20161027    NaN
20161128    NaN
20161117    NaN
20161102    NaN
20161102    NaN
20160927    NaN
20161214    NaN
20160926    NaN
(332099, 2036) (29445, 2036)
          y_l_rise  y_l_decline   y_l_avg  y_s_rise  y_s_decline   y_s_avg  \
date
20180702  0.131731    -0.113462  0.010095  0.048077    -0.113462 -0.028717
20180702  0.094720    -0.064056  0.031932  0.075637    -0.064056  0.010495
20180702  0.047527    -0.081567 -0.012935  0.000642    -0.081567 -0.040401
20180702  0.083636    -0.029091  0.016892  0.036364    -0.018182  0.009272
20180702  0.173484    -0.089366  0.060259  0.000000    -0.089366 -0.037225
20180702  0.086037    -0.049365  0.029736  0.032440    -0.049365 -0.004042
20180702  0.099291    -0.007092  0.053465  0.037825    -0.007092  0.017350
20180702  0.196126    -0.041162  0.054833  0.036320    -0.041162  0.002209
20180702  0.161572    -0.049491  0.098269  0.072780    -0.049491  0.018849
20180702  0.112392    -0.046110  0.040382  0.020173    -0.031700  0.001200
20180702  0.026711    -0.235392 -0.135519  0.026711    -0.063439 -0.013439
20180702  0.070423    -0.070423 -0.001644  0.009577    -0.070423 -0.022191
20180702  0.212513    -0.038617  0.088093  0.064730    -0.038617  0.020130
20180702  0.190231     0.000000  0.108106  0.089974     0.000000  0.050105
20180702  0.037143    -0.110000 -0.047763  0.037143    -0.064286 -0.007056
20180702  0.040896    -0.127556 -0.054137  0.034080    -0.042843  0.001272
20180702  0.105212    -0.012917  0.046348  0.036598    -0.012917  0.008469
20180702  0.053135    -0.051635  0.009424  0.005164    -0.051635 -0.013805
20180702  0.033344    -0.116543 -0.030064  0.033344    -0.057948 -0.006487
20180702  0.327982    -0.021407  0.202673  0.093272    -0.021407  0.023226

               y_l     y_l_r
date
20180702  0.131731  0.101322
20180702  0.094720  0.079023
20180702 -0.081567 -0.064409
20180702  0.083636  0.066950
20180702  0.173484  0.145177
20180702  0.086037  0.071961
20180702  0.099291  0.087834
20180702  0.196126  0.160803
20180702  0.161572  0.145746
20180702  0.112392  0.094389
20180702 -0.235392 -0.210424
20180702 -0.070423 -0.053228
20180702  0.212513  0.181408
20180702  0.190231  0.169700
20180702 -0.110000 -0.094441
20180702 -0.127556 -0.109201
20180702  0.105212  0.090496
20180702  0.053135  0.042207
20180702 -0.116543 -0.094923
20180702  0.327982  0.296654

--------------------Train network--------------------

 (332099, 2036) (332099,) {'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}, 'train_indexes': (0, None)}

----------Train layer 0----------
slice(0, None, None)

Train l2_y_l
C:\Users\dell-pc\Anaconda3.6\lib\site-packages\lightgbm\basic.py:1042: UserWarning: categorical_feature in Dataset is overridden. New categorical_feature is ['area', 'exchange', 'is_hs', 'market']
  warnings.warn('categorical_feature in Dataset is overridden. New categorical_feature is {}'.format(sorted(list(categorical_feature))))
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 369.19s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.1, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=50,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                    feature  importance_raw  \
2025                                 sz_vol             110
1865                               sz50_vol             106
1705                                 sh_vol              87
895                               hs300_vol              45
567                                     amt              44
732                                 cyb_vol              34
1526        p80mv_(20k_low/p20mv_20k_low-1)              26
1449  p600mv_(120k_low-120k_close)/120k_avg              22
454                          (high-low)/avg              21
1466        p60mv_(20k_low/p20mv_20k_low-1)              19
1268           p360mv_lower_shadow/120k_avg              17
1321        p40mv_(20k_avg/p20mv_20k_avg-1)              15
937      p100mv_(20k_open/p20mv_20k_open-1)              14
1241        p30mv_(10k_avg/p10mv_10k_avg-1)              14
1350           p480mv_lower_shadow/120k_avg              13
1457        p60mv_(20k_avg/p20mv_20k_avg-1)              13
1061       p180mv_(60k_amt/p60mv_60k_amt-1)              12
1480      p60mv_(60k_open/p60mv_60k_open-1)              11
1450   p600mv_(120k_low-120k_open)/120k_avg              11
1120       p20mv_(20k_low-20k_open)/20k_avg              11

      importance_percent
2025                7.33
1865                7.07
1705                5.80
895                 3.00
567                 2.93
732                 2.27
1526                1.73
1449                1.47
454                 1.40
1466                1.27
1268                1.13
1321                1.00
937                 0.93
1241                0.93
1350                0.87
1457                0.87
1061                0.80
1480                0.73
1450                0.73
1120                0.73
Among 2036 features, 1636 features are not used in the model

--------------------Predict--------------------

----------Layer 0 predicts----------

y_l_r
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     28     -0.095       -0.122     0.151     0.384    -0.300
(-0.05,0.00]    2928     -0.045       -0.070     0.127     0.726    -0.434
(0.00,0.05]    20622     -0.017       -0.045     0.126     0.924    -0.643
(0.05,0.10]     4417      0.018        0.056     0.155     1.178    -0.483
(0.10,0.15]     1064      0.051        0.093     0.184     0.585    -0.420
(0.15,0.20]      337      0.043        0.095     0.188     0.563    -0.366
(0.20,0.25]       44      0.062        0.131     0.201     0.330    -0.305
(0.25,0.30]        5      0.216        0.234     0.064     0.293     0.141
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     28     -0.109       -0.148     0.175     0.438    -0.333
(-0.05,0.00]    2928     -0.059       -0.091     0.146     0.813    -0.463
(0.00,0.05]    20622     -0.026       -0.065     0.147     1.018    -0.670
(0.05,0.10]     4417      0.015        0.058     0.183     1.328    -0.534
(0.10,0.15]     1064      0.049        0.111     0.218     0.695    -0.467
(0.15,0.20]      337      0.048        0.121     0.223     0.630    -0.409
(0.20,0.25]       44      0.069        0.165     0.243     0.382    -0.361
(0.25,0.30]        5      0.253        0.266     0.068     0.334     0.167
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_avg
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     28     -0.054       -0.049     0.086     0.223    -0.226
(-0.05,0.00]    2928     -0.023       -0.018     0.070     0.472    -0.356
(0.00,0.05]    20622     -0.007       -0.005     0.067     0.660    -0.564
(0.05,0.10]     4417      0.012        0.007     0.081     0.730    -0.329
(0.10,0.15]     1064      0.026        0.023     0.096     0.384    -0.278
(0.15,0.20]      337      0.022        0.015     0.093     0.363    -0.246
(0.20,0.25]       44      0.038        0.044     0.091     0.186    -0.173
(0.25,0.30]        5      0.106        0.123     0.055     0.169     0.037
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_rise
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]     28      0.062        0.033     0.087     0.438     0.000
(-0.05,0.00]    2928      0.059        0.039     0.069     0.813     0.000
(0.00,0.05]    20622      0.072        0.053     0.071     1.018     0.000
(0.05,0.10]     4417      0.110        0.088     0.099     1.328     0.000
(0.10,0.15]     1064      0.148        0.121     0.119     0.695     0.000
(0.15,0.20]      337      0.155        0.131     0.119     0.630     0.000
(0.20,0.25]       44      0.182        0.168     0.107     0.382     0.012
(0.25,0.30]        5      0.253        0.266     0.068     0.334     0.167
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

















fit y_l
C:\Users\dell-pc\Anaconda3.6\python.exe C:/Users/dell-pc/Quant/Quant/ml_model.py
2013-01-01 2018-12-31
Time slice keys in hdf5: 2013/0101-0101,2014/0101-0101,2015/0101-0101,2016/0101-0101,2017/0101-0101,2018/0101-0101

Current key: 2013/0101-0101
Current slice size(length): 278061
Current subsample size(length): 55612

Current key: 2014/0101-0101
Current slice size(length): 291574
Current subsample size(length): 58314

Current key: 2015/0101-0101
Current slice size(length): 304680
Current subsample size(length): 60936

Current key: 2016/0101-0101
Current slice size(length): 313767
Current subsample size(length): 62753

Current key: 2017/0101-0101
Current slice size(length): 333371
Current subsample size(length): 66674

Current key: 2018/0101-0101
Current slice size(length): 347712
Current subsample size(length): 69542

Total concatenating size: 373831
Result dataset size: 373831
<class 'pandas.core.frame.DataFrame'>
Int64Index: 373831 entries, 20130607 to 20180925
Columns: 2037 entries, (10MA/20MA-1) to vol0
dtypes: float16(1987), float64(44), int64(1), uint8(5)
memory usage: 1.5 GB
None
(185, 8)
          y_l_rise  y_l_decline  y_l_avg  y_s_rise  y_s_decline  y_s_avg  y_l  \
date
20161202       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161216       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161121       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161208       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161205       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161025       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161103       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161111       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161026       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161108       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161125       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161010       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161027       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161128       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161117       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161102       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161102       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20160927       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161214       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20160926       0.0          0.0      NaN       0.0          0.0      NaN  0.0

          y_l_r
date
20161202    NaN
20161216    NaN
20161121    NaN
20161208    NaN
20161205    NaN
20161025    NaN
20161103    NaN
20161111    NaN
20161026    NaN
20161108    NaN
20161125    NaN
20161010    NaN
20161027    NaN
20161128    NaN
20161117    NaN
20161102    NaN
20161102    NaN
20160927    NaN
20161214    NaN
20160926    NaN
(332099, 2036) (29445, 2036)

--------------------Train network--------------------

 (332099, 2036) (332099,) {'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}, 'train_indexes': (0, None)}

----------Train layer 0----------
slice(0, None, None)

Train l2_y_l
C:\Users\dell-pc\Anaconda3.6\lib\site-packages\lightgbm\basic.py:1042: UserWarning: categorical_feature in Dataset is overridden. New categorical_feature is ['area', 'exchange', 'is_hs', 'market']
  warnings.warn('categorical_feature in Dataset is overridden. New categorical_feature is {}'.format(sorted(list(categorical_feature))))
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 307.20s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.1, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=50,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                    feature  importance_raw  \
2025                                 sz_vol             114
1865                               sz50_vol             114
1705                                 sh_vol              85
567                                     amt              50
895                               hs300_vol              50
1526        p80mv_(20k_low/p20mv_20k_low-1)              36
732                                 cyb_vol              31
1466        p60mv_(20k_low/p20mv_20k_low-1)              25
454                          (high-low)/avg              23
1457        p60mv_(20k_avg/p20mv_20k_avg-1)              16
1449  p600mv_(120k_low-120k_close)/120k_avg              16
1120       p20mv_(20k_low-20k_open)/20k_avg              16
1061       p180mv_(60k_amt/p60mv_60k_amt-1)              12
1321        p40mv_(20k_avg/p20mv_20k_avg-1)              12
1350           p480mv_lower_shadow/120k_avg              11
141             (20k_high/p80mv_20k_high-1)              11
986     p120mv_(60k_close-60k_open)/60k_avg              11
1268           p360mv_lower_shadow/120k_avg              11
1450   p600mv_(120k_low-120k_open)/120k_avg              10
453                        (high-close)/avg              10

      importance_percent
2025                7.60
1865                7.60
1705                5.67
567                 3.33
895                 3.33
1526                2.40
732                 2.07
1466                1.67
454                 1.53
1457                1.07
1449                1.07
1120                1.07
1061                0.80
1321                0.80
1350                0.73
141                 0.73
986                 0.73
1268                0.73
1450                0.67
453                 0.67
Among 2036 features, 1655 features are not used in the model

--------------------Predict--------------------

----------Layer 0 predicts----------

y_l_r
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]    106     -0.070       -0.111     0.126     0.384    -0.370
(-0.05,0.00]    3910     -0.049       -0.073     0.126     0.888    -0.562
(0.00,0.05]    18544     -0.015       -0.042     0.126     0.924    -0.643
(0.05,0.10]     5013      0.010        0.042     0.148     1.178    -0.483
(0.10,0.15]     1218      0.050        0.093     0.180     0.776    -0.420
(0.15,0.20]      543      0.046        0.090     0.192     0.573    -0.366
(0.20,0.25]      102      0.059        0.119     0.193     0.422    -0.336
(0.25,0.30]        9      0.117        0.161     0.152     0.253    -0.172
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]    106     -0.091       -0.133     0.144     0.438    -0.407
(-0.05,0.00]    3910     -0.063       -0.093     0.145     0.983    -0.590
(0.00,0.05]    18544     -0.023       -0.063     0.147     1.018    -0.670
(0.05,0.10]     5013      0.005       -0.044     0.174     1.328    -0.534
(0.10,0.15]     1218      0.050        0.112     0.213     0.872    -0.467
(0.15,0.20]      543      0.047        0.106     0.227     0.636    -0.409
(0.20,0.25]      102      0.071        0.148     0.229     0.483    -0.402
(0.25,0.30]        9      0.174        0.202     0.147     0.296    -0.191
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_avg
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]    106     -0.034       -0.036     0.064     0.223    -0.256
(-0.05,0.00]    3910     -0.024       -0.018     0.069     0.602    -0.481
(0.00,0.05]    18544     -0.006       -0.005     0.067     0.660    -0.564
(0.05,0.10]     5013      0.007        0.003     0.077     0.730    -0.329
(0.10,0.15]     1218      0.027        0.025     0.093     0.486    -0.278
(0.15,0.20]      543      0.023        0.016     0.098     0.384    -0.277
(0.20,0.25]      102      0.031        0.024     0.090     0.240    -0.176
(0.25,0.30]        9      0.048        0.052     0.079     0.138    -0.112
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_rise
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      0        NaN          NaN       NaN       NaN       NaN
(-0.15,-0.10]      0        NaN          NaN       NaN       NaN       NaN
(-0.10,-0.05]    106      0.057        0.045     0.066     0.438     0.000
(-0.05,0.00]    3910      0.058        0.040     0.067     0.983     0.000
(0.00,0.05]    18544      0.072        0.053     0.072     1.018     0.000
(0.05,0.10]     5013      0.101        0.078     0.092     1.328     0.000
(0.10,0.15]     1218      0.146        0.121     0.116     0.872     0.000
(0.15,0.20]      543      0.153        0.123     0.126     0.636     0.000
(0.20,0.25]      102      0.171        0.153     0.112     0.483     0.007
(0.25,0.30]        9      0.200        0.202     0.080     0.296     0.040
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN











C:\Users\dell-pc\Anaconda3.6\python.exe C:/Users/dell-pc/Quant/Quant/ml_model.py
2013-01-01 2018-12-31
Time slice keys in hdf5: 2013/0101-0101,2014/0101-0101,2015/0101-0101,2016/0101-0101,2017/0101-0101,2018/0101-0101

Current key: 2013/0101-0101
Current slice size(length): 278061
Current subsample size(length): 27806

Current key: 2014/0101-0101
Current slice size(length): 291574
Current subsample size(length): 29157

Current key: 2015/0101-0101
Current slice size(length): 304680
Current subsample size(length): 30468

Current key: 2016/0101-0101
Current slice size(length): 313767
Current subsample size(length): 31376

Current key: 2017/0101-0101
Current slice size(length): 333371
Current subsample size(length): 33337

Current key: 2018/0101-0101
Current slice size(length): 347712
Current subsample size(length): 34771

Total concatenating size: 186915
Result dataset size: 186915
<class 'pandas.core.frame.DataFrame'>
Int64Index: 186915 entries, 20130607 to 20180925
Columns: 2037 entries, (10MA/20MA-1) to vol0
dtypes: float16(1987), float64(44), int64(1), uint8(5)
memory usage: 774.9 MB
None
(95, 8)
          y_l_rise  y_l_decline  y_l_avg  y_s_rise  y_s_decline  y_s_avg  y_l  \
date
20161202       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161216       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161208       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161205       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161025       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161026       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161010       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161027       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161117       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161102       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20160927       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161214       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161014       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161226       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20161020       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170324       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170707       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170926       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170926       0.0          0.0      NaN       0.0          0.0      NaN  0.0
20170405       0.0          0.0      NaN       0.0          0.0      NaN  0.0

          y_l_r
date
20161202    NaN
20161216    NaN
20161208    NaN
20161205    NaN
20161025    NaN
20161026    NaN
20161010    NaN
20161027    NaN
20161117    NaN
20161102    NaN
20160927    NaN
20161214    NaN
20161014    NaN
20161226    NaN
20161020    NaN
20170324    NaN
20170707    NaN
20170926    NaN
20170926    NaN
20170405    NaN

test period:20180701-20190101
(166068, 2036) (17810, 2036)

--------------------Train network--------------------

 (166068, 2036) (166068,) {'train_indexes': (0, 55356), 'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}}

----------Train layer 0----------
slice(0, 55356, None)

Train custom_revenue_y_l_avg
C:\Users\dell-pc\Anaconda3.6\lib\site-packages\lightgbm\basic.py:1042: UserWarning: categorical_feature in Dataset is overridden. New categorical_feature is ['area', 'exchange', 'is_hs', 'market']
  warnings.warn('categorical_feature in Dataset is overridden. New categorical_feature is {}'.format(sorted(list(categorical_feature))))
[LightGBM] [Warning] Using self-defined objective function
[LightGBM] [Warning] Using self-defined objective function
Time usage: 21.18s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=2, max_depth=8, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=10,
       n_jobs=-1, num_leaves=15,
       objective=<function custom_revenue_obj at 0x0000024DE43E4EA0>,
       random_state=0, reg_alpha=0.0, reg_lambda=0.0, silent=True,
       subsample=1.0, subsample_for_bin=200000, subsample_freq=0)
                                     feature  importance_raw  \
1705                                  sh_vol              30
1526         p80mv_(20k_low/p20mv_20k_low-1)              10
1014           p1250mv_lower_shadow/250k_avg              10
1466         p60mv_(20k_low/p20mv_20k_low-1)              10
1238             p300mv_lower_shadow/60k_avg              10
1160     p240mv_(60k_high-60k_close)/60k_avg              10
2025                                  sz_vol              10
234                  (3k_high-3k_low)/3k_avg               8
1009  p1250mv_(250k_low-250k_close)/250k_avg               8
2035                                    vol0               6
173            (250k_avg/p1250mv_250k_avg-1)               4
1471      p60mv_(60k_close-60k_open)/60k_avg               4
1235        p300mv_(60k_low/p60mv_60k_low-1)               4
2034                                     vol               4
895                                hs300_vol               4
567                                      amt               2
372                      (amt/p10mean_amt-1)               2
1472     p60mv_(60k_close/p60mv_60k_close-1)               2
218                   (3k_amt/p6mv_3k_amt-1)               1
543                      (vol/p120max_vol-1)               1

      importance_percent
1705               21.43
1526                7.14
1014                7.14
1466                7.14
1238                7.14
1160                7.14
2025                7.14
234                 5.71
1009                5.71
2035                4.29
173                 2.86
1471                2.86
1235                2.86
2034                2.86
895                 2.86
567                 1.43
372                 1.43
1472                1.43
218                 0.71
543                 0.71
Among 2036 features, 2016 features are not used in the model

Train custom_revenue2_y_s_decline
[LightGBM] [Warning] Using self-defined objective function
[LightGBM] [Warning] Using self-defined objective function
Time usage: 21.40s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=2, max_depth=8, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=10,
       n_jobs=-1, num_leaves=15,
       objective=<function custom_revenue2_obj at 0x0000024DE43F00D0>,
       random_state=0, reg_alpha=0.0, reg_lambda=0.0, silent=True,
       subsample=1.0, subsample_for_bin=200000, subsample_freq=0)
                                      feature  importance_raw  \
1705                                   sh_vol              11
2025                                   sz_vol               8
567                                       amt               8
1466          p60mv_(20k_low/p20mv_20k_low-1)               8
1526          p80mv_(20k_low/p20mv_20k_low-1)               7
1235         p300mv_(60k_low/p60mv_60k_low-1)               4
1005  p1250mv_(250k_high-250k_close)/250k_avg               4
1014            p1250mv_lower_shadow/250k_avg               3
1227      p300mv_(60k_close-60k_open)/60k_avg               2
359              (60k_open/p120mv_60k_open-1)               2
1238              p300mv_lower_shadow/60k_avg               2
234                   (3k_high-3k_low)/3k_avg               2
1865                                 sz50_vol               2
1263    p360mv_(120k_low-120k_close)/120k_avg               2
919    p1000mv_(250k_low-250k_close)/250k_avg               2
1160      p240mv_(60k_high-60k_close)/60k_avg               2
357                 (60k_low/p60mv_60k_low-1)               2
1166         p240mv_(60k_low/p60mv_60k_low-1)               2
96                    (120k_open/250k_open-1)               2
936          p100mv_(20k_low/p20mv_20k_low-1)               2

      importance_percent
1705                7.86
2025                5.71
567                 5.71
1466                5.71
1526                5.00
1235                2.86
1005                2.86
1014                2.14
1227                1.43
359                 1.43
1238                1.43
234                 1.43
1865                1.43
1263                1.43
919                 1.43
1160                1.43
357                 1.43
1166                1.43
96                  1.43
936                 1.43
Among 2036 features, 1959 features are not used in the model

Train custom_revenue_y_s_rise
[LightGBM] [Warning] Using self-defined objective function
[LightGBM] [Warning] Using self-defined objective function
Time usage: 21.45s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=2, max_depth=8, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=10,
       n_jobs=-1, num_leaves=15,
       objective=<function custom_revenue_obj at 0x0000024DE43E4EA0>,
       random_state=0, reg_alpha=0.0, reg_lambda=0.0, silent=True,
       subsample=1.0, subsample_for_bin=200000, subsample_freq=0)
                                     feature  importance_raw  \
1705                                  sh_vol              30
1526         p80mv_(20k_low/p20mv_20k_low-1)              10
1014           p1250mv_lower_shadow/250k_avg              10
1466         p60mv_(20k_low/p20mv_20k_low-1)              10
1238             p300mv_lower_shadow/60k_avg              10
1160     p240mv_(60k_high-60k_close)/60k_avg              10
2025                                  sz_vol              10
234                  (3k_high-3k_low)/3k_avg               8
1009  p1250mv_(250k_low-250k_close)/250k_avg               8
2035                                    vol0               6
173            (250k_avg/p1250mv_250k_avg-1)               4
1471      p60mv_(60k_close-60k_open)/60k_avg               4
1235        p300mv_(60k_low/p60mv_60k_low-1)               4
2034                                     vol               4
895                                hs300_vol               4
567                                      amt               2
372                      (amt/p10mean_amt-1)               2
1472     p60mv_(60k_close/p60mv_60k_close-1)               2
218                   (3k_amt/p6mv_3k_amt-1)               1
543                      (vol/p120max_vol-1)               1

      importance_percent
1705               21.43
1526                7.14
1014                7.14
1466                7.14
1238                7.14
1160                7.14
2025                7.14
234                 5.71
1009                5.71
2035                4.29
173                 2.86
1471                2.86
1235                2.86
2034                2.86
895                 2.86
567                 1.43
372                 1.43
1472                1.43
218                 0.71
543                 0.71
Among 2036 features, 2016 features are not used in the model

Train custom_revenue2_y_l_decline
[LightGBM] [Warning] Using self-defined objective function
[LightGBM] [Warning] Using self-defined objective function
Time usage: 21.85s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=2, max_depth=8, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=10,
       n_jobs=-1, num_leaves=15,
       objective=<function custom_revenue2_obj at 0x0000024DE43F00D0>,
       random_state=0, reg_alpha=0.0, reg_lambda=0.0, silent=True,
       subsample=1.0, subsample_for_bin=200000, subsample_freq=0)
                                      feature  importance_raw  \
1705                                   sh_vol              11
2025                                   sz_vol               8
567                                       amt               8
1466          p60mv_(20k_low/p20mv_20k_low-1)               8
1526          p80mv_(20k_low/p20mv_20k_low-1)               7
1235         p300mv_(60k_low/p60mv_60k_low-1)               4
1005  p1250mv_(250k_high-250k_close)/250k_avg               4
1014            p1250mv_lower_shadow/250k_avg               3
1227      p300mv_(60k_close-60k_open)/60k_avg               2
359              (60k_open/p120mv_60k_open-1)               2
1238              p300mv_lower_shadow/60k_avg               2
234                   (3k_high-3k_low)/3k_avg               2
1865                                 sz50_vol               2
1263    p360mv_(120k_low-120k_close)/120k_avg               2
919    p1000mv_(250k_low-250k_close)/250k_avg               2
1160      p240mv_(60k_high-60k_close)/60k_avg               2
357                 (60k_low/p60mv_60k_low-1)               2
1166         p240mv_(60k_low/p60mv_60k_low-1)               2
96                    (120k_open/250k_open-1)               2
936          p100mv_(20k_low/p20mv_20k_low-1)               2

      importance_percent
1705                7.86
2025                5.71
567                 5.71
1466                5.71
1526                5.00
1235                2.86
1005                2.86
1014                2.14
1227                1.43
359                 1.43
1238                1.43
234                 1.43
1865                1.43
1263                1.43
919                 1.43
1160                1.43
357                 1.43
1166                1.43
96                  1.43
936                 1.43
Among 2036 features, 1959 features are not used in the model

Train custom_revenue_y_l_decline
[LightGBM] [Warning] Using self-defined objective function
[LightGBM] [Warning] Using self-defined objective function
Time usage: 21.52s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=2, max_depth=8, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=10,
       n_jobs=-1, num_leaves=15,
       objective=<function custom_revenue_obj at 0x0000024DE43E4EA0>,
       random_state=0, reg_alpha=0.0, reg_lambda=0.0, silent=True,
       subsample=1.0, subsample_for_bin=200000, subsample_freq=0)
                                     feature  importance_raw  \
1705                                  sh_vol              30
1526         p80mv_(20k_low/p20mv_20k_low-1)              10
1014           p1250mv_lower_shadow/250k_avg              10
1466         p60mv_(20k_low/p20mv_20k_low-1)              10
1238             p300mv_lower_shadow/60k_avg              10
1160     p240mv_(60k_high-60k_close)/60k_avg              10
2025                                  sz_vol              10
234                  (3k_high-3k_low)/3k_avg               8
1009  p1250mv_(250k_low-250k_close)/250k_avg               8
2035                                    vol0               6
173            (250k_avg/p1250mv_250k_avg-1)               4
1471      p60mv_(60k_close-60k_open)/60k_avg               4
1235        p300mv_(60k_low/p60mv_60k_low-1)               4
2034                                     vol               4
895                                hs300_vol               4
567                                      amt               2
372                      (amt/p10mean_amt-1)               2
1472     p60mv_(60k_close/p60mv_60k_close-1)               2
218                   (3k_amt/p6mv_3k_amt-1)               1
543                      (vol/p120max_vol-1)               1

      importance_percent
1705               21.43
1526                7.14
1014                7.14
1466                7.14
1238                7.14
1160                7.14
2025                7.14
234                 5.71
1009                5.71
2035                4.29
173                 2.86
1471                2.86
1235                2.86
2034                2.86
895                 2.86
567                 1.43
372                 1.43
1472                1.43
218                 0.71
543                 0.71
Among 2036 features, 2016 features are not used in the model

Train custom_revenue2_y_s_rise
[LightGBM] [Warning] Using self-defined objective function
[LightGBM] [Warning] Using self-defined objective function
Time usage: 21.72s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=2, max_depth=8, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=10,
       n_jobs=-1, num_leaves=15,
       objective=<function custom_revenue2_obj at 0x0000024DE43F00D0>,
       random_state=0, reg_alpha=0.0, reg_lambda=0.0, silent=True,
       subsample=1.0, subsample_for_bin=200000, subsample_freq=0)
                                      feature  importance_raw  \
1705                                   sh_vol              11
2025                                   sz_vol               8
567                                       amt               8
1466          p60mv_(20k_low/p20mv_20k_low-1)               8
1526          p80mv_(20k_low/p20mv_20k_low-1)               7
1235         p300mv_(60k_low/p60mv_60k_low-1)               4
1005  p1250mv_(250k_high-250k_close)/250k_avg               4
1014            p1250mv_lower_shadow/250k_avg               3
1227      p300mv_(60k_close-60k_open)/60k_avg               2
359              (60k_open/p120mv_60k_open-1)               2
1238              p300mv_lower_shadow/60k_avg               2
234                   (3k_high-3k_low)/3k_avg               2
1865                                 sz50_vol               2
1263    p360mv_(120k_low-120k_close)/120k_avg               2
919    p1000mv_(250k_low-250k_close)/250k_avg               2
1160      p240mv_(60k_high-60k_close)/60k_avg               2
357                 (60k_low/p60mv_60k_low-1)               2
1166         p240mv_(60k_low/p60mv_60k_low-1)               2
96                    (120k_open/250k_open-1)               2
936          p100mv_(20k_low/p20mv_20k_low-1)               2

      importance_percent
1705                7.86
2025                5.71
567                 5.71
1466                5.71
1526                5.00
1235                2.86
1005                2.86
1014                2.14
1227                1.43
359                 1.43
1238                1.43
234                 1.43
1865                1.43
1263                1.43
919                 1.43
1160                1.43
357                 1.43
1166                1.43
96                  1.43
936                 1.43
Among 2036 features, 1959 features are not used in the model

Train custom_revenue_y_s_decline
[LightGBM] [Warning] Using self-defined objective function
[LightGBM] [Warning] Using self-defined objective function
Time usage: 21.91s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=2, max_depth=8, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=10,
       n_jobs=-1, num_leaves=15,
       objective=<function custom_revenue_obj at 0x0000024DE43E4EA0>,
       random_state=0, reg_alpha=0.0, reg_lambda=0.0, silent=True,
       subsample=1.0, subsample_for_bin=200000, subsample_freq=0)
                                     feature  importance_raw  \
1705                                  sh_vol              30
1526         p80mv_(20k_low/p20mv_20k_low-1)              10
1014           p1250mv_lower_shadow/250k_avg              10
1466         p60mv_(20k_low/p20mv_20k_low-1)              10
1238             p300mv_lower_shadow/60k_avg              10
1160     p240mv_(60k_high-60k_close)/60k_avg              10
2025                                  sz_vol              10
234                  (3k_high-3k_low)/3k_avg               8
1009  p1250mv_(250k_low-250k_close)/250k_avg               8
2035                                    vol0               6
173            (250k_avg/p1250mv_250k_avg-1)               4
1471      p60mv_(60k_close-60k_open)/60k_avg               4
1235        p300mv_(60k_low/p60mv_60k_low-1)               4
2034                                     vol               4
895                                hs300_vol               4
567                                      amt               2
372                      (amt/p10mean_amt-1)               2
1472     p60mv_(60k_close/p60mv_60k_close-1)               2
218                   (3k_amt/p6mv_3k_amt-1)               1
543                      (vol/p120max_vol-1)               1

      importance_percent
1705               21.43
1526                7.14
1014                7.14
1466                7.14
1238                7.14
1160                7.14
2025                7.14
234                 5.71
1009                5.71
2035                4.29
173                 2.86
1471                2.86
1235                2.86
2034                2.86
895                 2.86
567                 1.43
372                 1.43
1472                1.43
218                 0.71
543                 0.71
Among 2036 features, 2016 features are not used in the model

Train custom_revenue_y_s_avg
[LightGBM] [Warning] Using self-defined objective function
[LightGBM] [Warning] Using self-defined objective function
Time usage: 21.86s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=2, max_depth=8, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=10,
       n_jobs=-1, num_leaves=15,
       objective=<function custom_revenue_obj at 0x0000024DE43E4EA0>,
       random_state=0, reg_alpha=0.0, reg_lambda=0.0, silent=True,
       subsample=1.0, subsample_for_bin=200000, subsample_freq=0)
                                     feature  importance_raw  \
1705                                  sh_vol              30
1526         p80mv_(20k_low/p20mv_20k_low-1)              10
1014           p1250mv_lower_shadow/250k_avg              10
1466         p60mv_(20k_low/p20mv_20k_low-1)              10
1238             p300mv_lower_shadow/60k_avg              10
1160     p240mv_(60k_high-60k_close)/60k_avg              10
2025                                  sz_vol              10
234                  (3k_high-3k_low)/3k_avg               8
1009  p1250mv_(250k_low-250k_close)/250k_avg               8
2035                                    vol0               6
173            (250k_avg/p1250mv_250k_avg-1)               4
1471      p60mv_(60k_close-60k_open)/60k_avg               4
1235        p300mv_(60k_low/p60mv_60k_low-1)               4
2034                                     vol               4
895                                hs300_vol               4
567                                      amt               2
372                      (amt/p10mean_amt-1)               2
1472     p60mv_(60k_close/p60mv_60k_close-1)               2
218                   (3k_amt/p6mv_3k_amt-1)               1
543                      (vol/p120max_vol-1)               1

      importance_percent
1705               21.43
1526                7.14
1014                7.14
1466                7.14
1238                7.14
1160                7.14
2025                7.14
234                 5.71
1009                5.71
2035                4.29
173                 2.86
1471                2.86
1235                2.86
2034                2.86
895                 2.86
567                 1.43
372                 1.43
1472                1.43
218                 0.71
543                 0.71
Among 2036 features, 2016 features are not used in the model

Train custom_revenue2_y_s_avg
[LightGBM] [Warning] Using self-defined objective function
[LightGBM] [Warning] Using self-defined objective function
Time usage: 22.07s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=2, max_depth=8, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=10,
       n_jobs=-1, num_leaves=15,
       objective=<function custom_revenue2_obj at 0x0000024DE43F00D0>,
       random_state=0, reg_alpha=0.0, reg_lambda=0.0, silent=True,
       subsample=1.0, subsample_for_bin=200000, subsample_freq=0)
                                      feature  importance_raw  \
1705                                   sh_vol              11
2025                                   sz_vol               8
567                                       amt               8
1466          p60mv_(20k_low/p20mv_20k_low-1)               8
1526          p80mv_(20k_low/p20mv_20k_low-1)               7
1235         p300mv_(60k_low/p60mv_60k_low-1)               4
1005  p1250mv_(250k_high-250k_close)/250k_avg               4
1014            p1250mv_lower_shadow/250k_avg               3
1227      p300mv_(60k_close-60k_open)/60k_avg               2
359              (60k_open/p120mv_60k_open-1)               2
1238              p300mv_lower_shadow/60k_avg               2
234                   (3k_high-3k_low)/3k_avg               2
1865                                 sz50_vol               2
1263    p360mv_(120k_low-120k_close)/120k_avg               2
919    p1000mv_(250k_low-250k_close)/250k_avg               2
1160      p240mv_(60k_high-60k_close)/60k_avg               2
357                 (60k_low/p60mv_60k_low-1)               2
1166         p240mv_(60k_low/p60mv_60k_low-1)               2
96                    (120k_open/250k_open-1)               2
936          p100mv_(20k_low/p20mv_20k_low-1)               2

      importance_percent
1705                7.86
2025                5.71
567                 5.71
1466                5.71
1526                5.00
1235                2.86
1005                2.86
1014                2.14
1227                1.43
359                 1.43
1238                1.43
234                 1.43
1865                1.43
1263                1.43
919                 1.43
1160                1.43
357                 1.43
1166                1.43
96                  1.43
936                 1.43
Among 2036 features, 1959 features are not used in the model

Train custom_revenue_y_l_rise
[LightGBM] [Warning] Using self-defined objective function
[LightGBM] [Warning] Using self-defined objective function
Time usage: 22.05s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=2, max_depth=8, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=10,
       n_jobs=-1, num_leaves=15,
       objective=<function custom_revenue_obj at 0x0000024DE43E4EA0>,
       random_state=0, reg_alpha=0.0, reg_lambda=0.0, silent=True,
       subsample=1.0, subsample_for_bin=200000, subsample_freq=0)
                                     feature  importance_raw  \
1705                                  sh_vol              30
1526         p80mv_(20k_low/p20mv_20k_low-1)              10
1014           p1250mv_lower_shadow/250k_avg              10
1466         p60mv_(20k_low/p20mv_20k_low-1)              10
1238             p300mv_lower_shadow/60k_avg              10
1160     p240mv_(60k_high-60k_close)/60k_avg              10
2025                                  sz_vol              10
234                  (3k_high-3k_low)/3k_avg               8
1009  p1250mv_(250k_low-250k_close)/250k_avg               8
2035                                    vol0               6
173            (250k_avg/p1250mv_250k_avg-1)               4
1471      p60mv_(60k_close-60k_open)/60k_avg               4
1235        p300mv_(60k_low/p60mv_60k_low-1)               4
2034                                     vol               4
895                                hs300_vol               4
567                                      amt               2
372                      (amt/p10mean_amt-1)               2
1472     p60mv_(60k_close/p60mv_60k_close-1)               2
218                   (3k_amt/p6mv_3k_amt-1)               1
543                      (vol/p120max_vol-1)               1

      importance_percent
1705               21.43
1526                7.14
1014                7.14
1466                7.14
1238                7.14
1160                7.14
2025                7.14
234                 5.71
1009                5.71
2035                4.29
173                 2.86
1471                2.86
1235                2.86
2034                2.86
895                 2.86
567                 1.43
372                 1.43
1472                1.43
218                 0.71
543                 0.71
Among 2036 features, 2016 features are not used in the model

Train custom_revenue2_y_l_rise
[LightGBM] [Warning] Using self-defined objective function
[LightGBM] [Warning] Using self-defined objective function
Time usage: 22.52s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=2, max_depth=8, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=10,
       n_jobs=-1, num_leaves=15,
       objective=<function custom_revenue2_obj at 0x0000024DE43F00D0>,
       random_state=0, reg_alpha=0.0, reg_lambda=0.0, silent=True,
       subsample=1.0, subsample_for_bin=200000, subsample_freq=0)
                                      feature  importance_raw  \
1705                                   sh_vol              11
2025                                   sz_vol               8
567                                       amt               8
1466          p60mv_(20k_low/p20mv_20k_low-1)               8
1526          p80mv_(20k_low/p20mv_20k_low-1)               7
1235         p300mv_(60k_low/p60mv_60k_low-1)               4
1005  p1250mv_(250k_high-250k_close)/250k_avg               4
1014            p1250mv_lower_shadow/250k_avg               3
1227      p300mv_(60k_close-60k_open)/60k_avg               2
359              (60k_open/p120mv_60k_open-1)               2
1238              p300mv_lower_shadow/60k_avg               2
234                   (3k_high-3k_low)/3k_avg               2
1865                                 sz50_vol               2
1263    p360mv_(120k_low-120k_close)/120k_avg               2
919    p1000mv_(250k_low-250k_close)/250k_avg               2
1160      p240mv_(60k_high-60k_close)/60k_avg               2
357                 (60k_low/p60mv_60k_low-1)               2
1166         p240mv_(60k_low/p60mv_60k_low-1)               2
96                    (120k_open/250k_open-1)               2
936          p100mv_(20k_low/p20mv_20k_low-1)               2

      importance_percent
1705                7.86
2025                5.71
567                 5.71
1466                5.71
1526                5.00
1235                2.86
1005                2.86
1014                2.14
1227                1.43
359                 1.43
1238                1.43
234                 1.43
1865                1.43
1263                1.43
919                 1.43
1160                1.43
357                 1.43
1166                1.43
96                  1.43
936                 1.43
Among 2036 features, 1959 features are not used in the model

Train custom_revenue2_y_l_avg
[LightGBM] [Warning] Using self-defined objective function
[LightGBM] [Warning] Using self-defined objective function
Time usage: 22.10s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=2, max_depth=8, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=10,
       n_jobs=-1, num_leaves=15,
       objective=<function custom_revenue2_obj at 0x0000024DE43F00D0>,
       random_state=0, reg_alpha=0.0, reg_lambda=0.0, silent=True,
       subsample=1.0, subsample_for_bin=200000, subsample_freq=0)
                                      feature  importance_raw  \
1705                                   sh_vol              11
2025                                   sz_vol               8
567                                       amt               8
1466          p60mv_(20k_low/p20mv_20k_low-1)               8
1526          p80mv_(20k_low/p20mv_20k_low-1)               7
1235         p300mv_(60k_low/p60mv_60k_low-1)               4
1005  p1250mv_(250k_high-250k_close)/250k_avg               4
1014            p1250mv_lower_shadow/250k_avg               3
1227      p300mv_(60k_close-60k_open)/60k_avg               2
359              (60k_open/p120mv_60k_open-1)               2
1238              p300mv_lower_shadow/60k_avg               2
234                   (3k_high-3k_low)/3k_avg               2
1865                                 sz50_vol               2
1263    p360mv_(120k_low-120k_close)/120k_avg               2
919    p1000mv_(250k_low-250k_close)/250k_avg               2
1160      p240mv_(60k_high-60k_close)/60k_avg               2
357                 (60k_low/p60mv_60k_low-1)               2
1166         p240mv_(60k_low/p60mv_60k_low-1)               2
96                    (120k_open/250k_open-1)               2
936          p100mv_(20k_low/p20mv_20k_low-1)               2

      importance_percent
1705                7.86
2025                5.71
567                 5.71
1466                5.71
1526                5.00
1235                2.86
1005                2.86
1014                2.14
1227                1.43
359                 1.43
1238                1.43
234                 1.43
1865                1.43
1263                1.43
919                 1.43
1160                1.43
357                 1.43
1166                1.43
96                  1.43
936                 1.43
Among 2036 features, 1959 features are not used in the model

----------Layer 0 predicts----------

 (166068, 2180) (166068,) {'train_indexes': (55356, 110712), 'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}}

----------Train layer 1----------
slice(55356, 110712, None)

Train l2_y_s_decline
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 32.27s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.2, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=25,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                            feature  importance_raw  \
1865                                       sz50_vol              47
2025                                         sz_vol              47
567                                             amt              18
1705                                         sh_vol              17
895                                       hs300_vol              17
568                                            area              12
1449          p600mv_(120k_low-120k_close)/120k_avg               9
732                                         cyb_vol               8
1350                   p480mv_lower_shadow/120k_avg               8
1347            p480mv_(120k_low/p120mv_120k_low-1)               8
1268                   p360mv_lower_shadow/120k_avg               7
1241                p30mv_(10k_avg/p10mv_10k_avg-1)               6
453                                (high-close)/avg               6
1341         p480mv_(120k_high-120k_close)/120k_avg               6
1062               p180mv_(60k_avg/p60mv_60k_avg-1)               5
1247              p30mv_(10k_high/p10mv_10k_high-1)               5
2050  layer0_custom_revenue2_y_s_decline_tree0_leaf               5
986             p120mv_(60k_close-60k_open)/60k_avg               5
1112                p20mv_(20k_avg/p20mv_20k_avg-1)               5
985                p120mv_(60k_avg/p60mv_60k_avg-1)               5

      importance_percent
1865                6.27
2025                6.27
567                 2.40
1705                2.27
895                 2.27
568                 1.60
1449                1.20
732                 1.07
1350                1.07
1347                1.07
1268                0.93
1241                0.80
453                 0.80
1341                0.80
1062                0.67
1247                0.67
2050                0.67
986                 0.67
1112                0.67
985                 0.67
Among 2180 features, 1843 features are not used in the model

Train l2_y_l_avg
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 32.11s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.2, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=25,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                            feature  importance_raw  \
1865                                       sz50_vol              47
2025                                         sz_vol              47
567                                             amt              18
1705                                         sh_vol              17
895                                       hs300_vol              17
568                                            area              12
1449          p600mv_(120k_low-120k_close)/120k_avg               9
732                                         cyb_vol               8
1350                   p480mv_lower_shadow/120k_avg               8
1347            p480mv_(120k_low/p120mv_120k_low-1)               8
1268                   p360mv_lower_shadow/120k_avg               7
1241                p30mv_(10k_avg/p10mv_10k_avg-1)               6
453                                (high-close)/avg               6
1341         p480mv_(120k_high-120k_close)/120k_avg               6
1062               p180mv_(60k_avg/p60mv_60k_avg-1)               5
1247              p30mv_(10k_high/p10mv_10k_high-1)               5
2050  layer0_custom_revenue2_y_s_decline_tree0_leaf               5
986             p120mv_(60k_close-60k_open)/60k_avg               5
1112                p20mv_(20k_avg/p20mv_20k_avg-1)               5
985                p120mv_(60k_avg/p60mv_60k_avg-1)               5

      importance_percent
1865                6.27
2025                6.27
567                 2.40
1705                2.27
895                 2.27
568                 1.60
1449                1.20
732                 1.07
1350                1.07
1347                1.07
1268                0.93
1241                0.80
453                 0.80
1341                0.80
1062                0.67
1247                0.67
2050                0.67
986                 0.67
1112                0.67
985                 0.67
Among 2180 features, 1843 features are not used in the model

Train l2_y_s_avg
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 32.93s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.2, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=25,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                            feature  importance_raw  \
1865                                       sz50_vol              47
2025                                         sz_vol              47
567                                             amt              18
1705                                         sh_vol              17
895                                       hs300_vol              17
568                                            area              12
1449          p600mv_(120k_low-120k_close)/120k_avg               9
732                                         cyb_vol               8
1350                   p480mv_lower_shadow/120k_avg               8
1347            p480mv_(120k_low/p120mv_120k_low-1)               8
1268                   p360mv_lower_shadow/120k_avg               7
1241                p30mv_(10k_avg/p10mv_10k_avg-1)               6
453                                (high-close)/avg               6
1341         p480mv_(120k_high-120k_close)/120k_avg               6
1062               p180mv_(60k_avg/p60mv_60k_avg-1)               5
1247              p30mv_(10k_high/p10mv_10k_high-1)               5
2050  layer0_custom_revenue2_y_s_decline_tree0_leaf               5
986             p120mv_(60k_close-60k_open)/60k_avg               5
1112                p20mv_(20k_avg/p20mv_20k_avg-1)               5
985                p120mv_(60k_avg/p60mv_60k_avg-1)               5

      importance_percent
1865                6.27
2025                6.27
567                 2.40
1705                2.27
895                 2.27
568                 1.60
1449                1.20
732                 1.07
1350                1.07
1347                1.07
1268                0.93
1241                0.80
453                 0.80
1341                0.80
1062                0.67
1247                0.67
2050                0.67
986                 0.67
1112                0.67
985                 0.67
Among 2180 features, 1843 features are not used in the model

Train l2_y_l_rise
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 32.50s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.2, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=25,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                            feature  importance_raw  \
1865                                       sz50_vol              47
2025                                         sz_vol              47
567                                             amt              18
1705                                         sh_vol              17
895                                       hs300_vol              17
568                                            area              12
1449          p600mv_(120k_low-120k_close)/120k_avg               9
732                                         cyb_vol               8
1350                   p480mv_lower_shadow/120k_avg               8
1347            p480mv_(120k_low/p120mv_120k_low-1)               8
1268                   p360mv_lower_shadow/120k_avg               7
1241                p30mv_(10k_avg/p10mv_10k_avg-1)               6
453                                (high-close)/avg               6
1341         p480mv_(120k_high-120k_close)/120k_avg               6
1062               p180mv_(60k_avg/p60mv_60k_avg-1)               5
1247              p30mv_(10k_high/p10mv_10k_high-1)               5
2050  layer0_custom_revenue2_y_s_decline_tree0_leaf               5
986             p120mv_(60k_close-60k_open)/60k_avg               5
1112                p20mv_(20k_avg/p20mv_20k_avg-1)               5
985                p120mv_(60k_avg/p60mv_60k_avg-1)               5

      importance_percent
1865                6.27
2025                6.27
567                 2.40
1705                2.27
895                 2.27
568                 1.60
1449                1.20
732                 1.07
1350                1.07
1347                1.07
1268                0.93
1241                0.80
453                 0.80
1341                0.80
1062                0.67
1247                0.67
2050                0.67
986                 0.67
1112                0.67
985                 0.67
Among 2180 features, 1843 features are not used in the model

Train l2_y_l_decline
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 32.41s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.2, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=25,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                            feature  importance_raw  \
1865                                       sz50_vol              47
2025                                         sz_vol              47
567                                             amt              18
1705                                         sh_vol              17
895                                       hs300_vol              17
568                                            area              12
1449          p600mv_(120k_low-120k_close)/120k_avg               9
732                                         cyb_vol               8
1350                   p480mv_lower_shadow/120k_avg               8
1347            p480mv_(120k_low/p120mv_120k_low-1)               8
1268                   p360mv_lower_shadow/120k_avg               7
1241                p30mv_(10k_avg/p10mv_10k_avg-1)               6
453                                (high-close)/avg               6
1341         p480mv_(120k_high-120k_close)/120k_avg               6
1062               p180mv_(60k_avg/p60mv_60k_avg-1)               5
1247              p30mv_(10k_high/p10mv_10k_high-1)               5
2050  layer0_custom_revenue2_y_s_decline_tree0_leaf               5
986             p120mv_(60k_close-60k_open)/60k_avg               5
1112                p20mv_(20k_avg/p20mv_20k_avg-1)               5
985                p120mv_(60k_avg/p60mv_60k_avg-1)               5

      importance_percent
1865                6.27
2025                6.27
567                 2.40
1705                2.27
895                 2.27
568                 1.60
1449                1.20
732                 1.07
1350                1.07
1347                1.07
1268                0.93
1241                0.80
453                 0.80
1341                0.80
1062                0.67
1247                0.67
2050                0.67
986                 0.67
1112                0.67
985                 0.67
Among 2180 features, 1843 features are not used in the model

Train l2_y_s_rise
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 32.48s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.2, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=25,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                            feature  importance_raw  \
1865                                       sz50_vol              47
2025                                         sz_vol              47
567                                             amt              18
1705                                         sh_vol              17
895                                       hs300_vol              17
568                                            area              12
1449          p600mv_(120k_low-120k_close)/120k_avg               9
732                                         cyb_vol               8
1350                   p480mv_lower_shadow/120k_avg               8
1347            p480mv_(120k_low/p120mv_120k_low-1)               8
1268                   p360mv_lower_shadow/120k_avg               7
1241                p30mv_(10k_avg/p10mv_10k_avg-1)               6
453                                (high-close)/avg               6
1341         p480mv_(120k_high-120k_close)/120k_avg               6
1062               p180mv_(60k_avg/p60mv_60k_avg-1)               5
1247              p30mv_(10k_high/p10mv_10k_high-1)               5
2050  layer0_custom_revenue2_y_s_decline_tree0_leaf               5
986             p120mv_(60k_close-60k_open)/60k_avg               5
1112                p20mv_(20k_avg/p20mv_20k_avg-1)               5
985                p120mv_(60k_avg/p60mv_60k_avg-1)               5

      importance_percent
1865                6.27
2025                6.27
567                 2.40
1705                2.27
895                 2.27
568                 1.60
1449                1.20
732                 1.07
1350                1.07
1347                1.07
1268                0.93
1241                0.80
453                 0.80
1341                0.80
1062                0.67
1247                0.67
2050                0.67
986                 0.67
1112                0.67
985                 0.67
Among 2180 features, 1843 features are not used in the model

----------Layer 1 predicts----------

 (166068, 2336) (166068,) {'train_indexes': (110712, None), 'fit': {'categorical_feature': ['area', 'market', 'exchange', 'is_hs']}}

----------Train layer 2----------
slice(110712, None, None)

Train l2_y_l_r
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
[LightGBM] [Warning] Accuracy may be bad since you didn't set num_leaves and 2^max_depth > num_leaves
Time usage: 47.08s
LGBMRegressor(boosting_type='gbdt', class_weight=None, colsample_bytree=1.0,
       learning_rate=0.1, max_depth=12, min_child_samples=30,
       min_child_weight=0.001, min_split_gain=0.0, n_estimators=50,
       n_jobs=-1, num_leaves=31, objective=None, random_state=0,
       reg_alpha=0.0, reg_lambda=0.0, silent=True, subsample=1.0,
       subsample_for_bin=200000, subsample_freq=0)
                                    feature  importance_raw  \
568                                    area              81
895                               hs300_vol              53
1705                                 sh_vol              48
1865                               sz50_vol              44
2025                                 sz_vol              39
1466        p60mv_(20k_low/p20mv_20k_low-1)              19
732                                 cyb_vol              17
994        p120mv_(60k_low/p60mv_60k_low-1)              15
1351           p480mv_upper_shadow/120k_avg              15
1236     p300mv_(60k_open/p60mv_60k_open-1)              13
1450   p600mv_(120k_low-120k_open)/120k_avg              12
1074            p180mv_lower_shadow/60k_avg              11
1509  p750mv_(250k_low-250k_close)/250k_avg              10
1157       p240mv_(60k_avg/p60mv_60k_avg-1)              10
1256    p360mv_(120k_avg/p120mv_120k_avg-1)               9
1399        p50mv_(10k_low/p10mv_10k_low-1)               9
1226       p300mv_(60k_avg/p60mv_60k_avg-1)               9
492                        (low/p1mv_low-1)               9
1166       p240mv_(60k_low/p60mv_60k_low-1)               9
567                                     amt               9

      importance_percent
568                 5.40
895                 3.53
1705                3.20
1865                2.93
2025                2.60
1466                1.27
732                 1.13
994                 1.00
1351                1.00
1236                0.87
1450                0.80
1074                0.73
1509                0.67
1157                0.67
1256                0.60
1399                0.60
1226                0.60
492                 0.60
1166                0.60
567                 0.60
Among 2336 features, 1767 features are not used in the model

--------------------Predict--------------------

----------Layer 0 predicts----------

----------Layer 1 predicts----------

----------Layer 2 predicts----------

y_l_r
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      3      0.100        0.074     0.272     0.384    -0.157
(-0.15,-0.10]     15     -0.053       -0.134     0.162     0.303    -0.205
(-0.10,-0.05]    466     -0.040       -0.075     0.136     0.650    -0.419
(-0.05,0.00]    6990     -0.026       -0.057     0.125     0.924    -0.635
(0.00,0.05]     8481     -0.010       -0.042     0.129     0.869    -0.584
(0.05,0.10]     1577      0.032        0.066     0.155     0.651    -0.417
(0.10,0.15]      247      0.090        0.129     0.181     0.531    -0.288
(0.15,0.20]       26      0.077        0.041     0.223     0.585    -0.231
(0.20,0.25]        4      0.087        0.122     0.151     0.229    -0.126
(0.25,0.30]        1      0.498        0.498       NaN     0.498     0.498
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      3      0.111        0.087     0.316     0.438    -0.194
(-0.15,-0.10]     15     -0.067       -0.160     0.190     0.342    -0.240
(-0.10,-0.05]    466     -0.055       -0.096     0.156     0.765    -0.466
(-0.05,0.00]    6990     -0.036       -0.076     0.145     1.012    -0.659
(0.00,0.05]     8481     -0.018       -0.062     0.151     0.953    -0.639
(0.05,0.10]     1577      0.030        0.071     0.183     0.733    -0.467
(0.10,0.15]      247      0.103        0.152     0.213     0.614    -0.320
(0.15,0.20]       26      0.096        0.100     0.264     0.695    -0.259
(0.20,0.25]        4      0.103        0.149     0.181     0.267    -0.153
(0.25,0.30]        1      0.602        0.602       NaN     0.602     0.602
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_avg
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      3      0.069        0.033     0.139     0.223    -0.047
(-0.15,-0.10]     15     -0.012       -0.042     0.078     0.187    -0.099
(-0.10,-0.05]    466     -0.020       -0.021     0.072     0.305    -0.278
(-0.05,0.00]    6990     -0.012       -0.011     0.066     0.660    -0.564
(0.00,0.05]     8481     -0.003       -0.005     0.067     0.617    -0.418
(0.05,0.10]     1577      0.019        0.012     0.079     0.405    -0.266
(0.10,0.15]      247      0.049        0.053     0.093     0.365    -0.211
(0.15,0.20]       26      0.040        0.007     0.098     0.260    -0.149
(0.20,0.25]        4      0.038        0.039     0.066     0.117    -0.044
(0.25,0.30]        1      0.186        0.186       NaN     0.186     0.186
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN

y_l_rise
               count  eval_mean  eval_median  eval_std  eval_max  eval_min
pred_range
(-1.00,-0.95]      0        NaN          NaN       NaN       NaN       NaN
(-0.95,-0.90]      0        NaN          NaN       NaN       NaN       NaN
(-0.90,-0.85]      0        NaN          NaN       NaN       NaN       NaN
(-0.85,-0.80]      0        NaN          NaN       NaN       NaN       NaN
(-0.80,-0.75]      0        NaN          NaN       NaN       NaN       NaN
(-0.75,-0.70]      0        NaN          NaN       NaN       NaN       NaN
(-0.70,-0.65]      0        NaN          NaN       NaN       NaN       NaN
(-0.65,-0.60]      0        NaN          NaN       NaN       NaN       NaN
(-0.60,-0.55]      0        NaN          NaN       NaN       NaN       NaN
(-0.55,-0.50]      0        NaN          NaN       NaN       NaN       NaN
(-0.50,-0.45]      0        NaN          NaN       NaN       NaN       NaN
(-0.45,-0.40]      0        NaN          NaN       NaN       NaN       NaN
(-0.40,-0.35]      0        NaN          NaN       NaN       NaN       NaN
(-0.35,-0.30]      0        NaN          NaN       NaN       NaN       NaN
(-0.30,-0.25]      0        NaN          NaN       NaN       NaN       NaN
(-0.25,-0.20]      0        NaN          NaN       NaN       NaN       NaN
(-0.20,-0.15]      3      0.196        0.087     0.210     0.438     0.063
(-0.15,-0.10]     15      0.093        0.060     0.093     0.342     0.015
(-0.10,-0.05]    466      0.071        0.049     0.077     0.765     0.000
(-0.05,0.00]    6990      0.067        0.048     0.071     1.012     0.000
(0.00,0.05]     8481      0.077        0.055     0.078     0.953     0.000
(0.05,0.10]     1577      0.119        0.095     0.101     0.733     0.000
(0.10,0.15]      247      0.172        0.152     0.129     0.614     0.000
(0.15,0.20]       26      0.180        0.102     0.190     0.695     0.000
(0.20,0.25]        4      0.151        0.149     0.096     0.267     0.037
(0.25,0.30]        1      0.602        0.602       NaN     0.602     0.602
(0.30,0.35]        0        NaN          NaN       NaN       NaN       NaN
(0.35,0.40]        0        NaN          NaN       NaN       NaN       NaN
(0.40,0.45]        0        NaN          NaN       NaN       NaN       NaN
(0.45,0.50]        0        NaN          NaN       NaN       NaN       NaN
(0.50,0.55]        0        NaN          NaN       NaN       NaN       NaN
(0.55,0.60]        0        NaN          NaN       NaN       NaN       NaN
(0.60,0.65]        0        NaN          NaN       NaN       NaN       NaN
(0.65,0.70]        0        NaN          NaN       NaN       NaN       NaN
(0.70,0.75]        0        NaN          NaN       NaN       NaN       NaN
(0.75,0.80]        0        NaN          NaN       NaN       NaN       NaN
(0.80,0.85]        0        NaN          NaN       NaN       NaN       NaN
(0.85,0.90]        0        NaN          NaN       NaN       NaN       NaN
(0.90,0.95]        0        NaN          NaN       NaN       NaN       NaN
(0.95,1.00]        0        NaN          NaN       NaN       NaN       NaN
